{"version":3,"sources":["../src/module.js"],"names":["MetricsPanelCtrl","_","$","d3","moment","MultistatPanelCtrl","$scope","$injector","alertSrv","panelDefaults","BarPadding","BaseLineColor","BaseLineValue","DateTimeColName","DateFormat","TooltipDateFormat","FlashHighLimitBar","FlashLowLimitBar","HighAxisColor","HighBarColor","HighLimitBarColor","HighLimitBarFlashColor","HighLimitBarFlashTimeout","HighLimitLineColor","HighLimitValue","HighSideMargin","Horizontal","LabelColName","LabelColor","LabelFontSize","LabelMargin","LowAxisColor","LowBarColor","LowLimitBarColor","LowLimitBarFlashColor","LowLimitBarFlashTimeout","LowLimitLineColor","LowLimitValue","LowSideMargin","MaxLineColor","MaxLineValue","MinLineValue","RecolorHighLimitBar","RecolorLowLimitBar","ShowBaseLine","ShowDate","FilterMultiples","ShowHighLimitLine","ShowLabels","ShowLeftAxis","ShowLowLimitLine","ShowMaxLine","ShowMinLine","ShowRightAxis","ShowTooltips","ShowValues","SortColName","SortDirection","TZOffsetHours","ValueColName","ValueDecimals","ValueColor","ValueFontSize","OddRowColor","EvenRowColor","GroupSortString","panel","elem","ctrl","defaults","events","on","onRender","bind","onDataReceived","onDataError","onInitEditMode","err","set","seriesList","render","metricNames","sortDirections","fontSizes","addEditorTab","dateTimeCol","$title","closest","find","$maxDate","length","append","children","last","maxDate","rows","i","dd","add","toUpperCase","text","fromNow","show","format","hide","data","pulse","highFlashRects","svg","selectAll","highRepeat","transition","duration","attr","lowFlashRects","lowRepeat","cols","labelCol","valueCol","sortCol","groupCol","GroupColName","oo","nest","key","d","rollup","entries","forEach","x","push","value","className","id","html","height","$container","h","w","width","ascending","sort","y","comp","buildDateHtml","horizontal","labelMargin","isNumeric","lowSideMargin","highSideMargin","select","barPadding","baseLineValue","minLineValue","maxLineValue","highBarColor","lowBarColor","highLimitValue","recolorHighLimitBar","lowLimitValue","recolorLowLimitBar","flashHighLimitBar","flashLowLimitBar","showTooltips","minValue","min","Number","maxValue","max","cc1","cc2","remove","tooltipDiv","style","tooltipShow","c","cc","toFixed","event","pageX","pageY","tooltipHide","plotGroupHorizontal","numRows","groupName","left","groupNameOffset","valueScale","scaleLinear","domain","range","nice","labels","map","concat","Math","random","toString","substr","labelScale","scaleBand","rangeRound","padding","oddeven","enter","bandwidth","vLine","color","MinLineColor","ww","classed","g","gg","call","axisTop","axisBottom","groupedRows","a","b","aPos","search","bPos","localeCompare","gap","dw","values","hLine","hh","axisLeft","tickSizeInner","tickSizeOuter","ticks","axisRight","renderingCompleted","type","columns","cols0","dataList","Type","refresh","scope","attrs","templateUrl"],"mappings":"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","file":"module.js","sourcesContent":["import { MetricsPanelCtrl } from 'app/plugins/sdk';\n\nimport './css/multistat-panel.css!';\n\nimport _ from 'lodash';\nimport $ from 'jquery';\nimport 'jquery.flot';\nimport d3 from './external/d3';\nimport moment from 'moment';\n\nclass MultistatPanelCtrl extends MetricsPanelCtrl {\n\n  /** @ngInject */\n  constructor($scope, $injector, alertSrv) {\n    super($scope, $injector);\n\n    this.alertSrv = alertSrv;\n\n    var panelDefaults = {\n      BarPadding: 10,\n      BaseLineColor: 'red',\n      BaseLineValue: 0,\n      DateTimeColName: 'date',\n      DateFormat: 'YYYY-MM-DD HH:mm:ss',\n      TooltipDateFormat: 'YYYY-MM-DD HH:mm:ss',\n      FlashHighLimitBar: true,\n      FlashLowLimitBar: true,\n      HighAxisColor: 'white',\n      HighBarColor: 'rgb(120, 128, 0)',\n      HighLimitBarColor: 'red',\n      HighLimitBarFlashColor: 'orange',\n      HighLimitBarFlashTimeout: 1000,\n      HighLimitLineColor: 'red',\n      HighLimitValue: 0.33,\n      HighSideMargin: 20,\n      Horizontal: false,\n      LabelColName: 'sensor',\n      LabelColor: 'white',\n      LabelFontSize: '100%',\n      LabelMargin: null,\n      LowAxisColor: 'white',\n      LowBarColor: 'teal',\n      LowLimitBarColor: 'red',\n      LowLimitBarFlashColor: 'orange',\n      LowLimitBarFlashTimeout: 200,\n      LowLimitLineColor: 'red',\n      LowLimitValue: null,\n      LowSideMargin: 20,\n      MaxLineColor: 'rgb(74, 232, 12)',\n      MaxLineValue: 1,\n      MinLineValue: 0,\n      RecolorHighLimitBar: true,\n      RecolorLowLimitBar: false,\n      ShowBaseLine: true,\n      ShowDate: false,\n      FilterMultiples: false,\n      ShowHighLimitLine: true,\n      ShowLabels: true,\n      ShowLeftAxis: true,\n      ShowLowLimitLine: false,\n      ShowMaxLine: false,\n      ShowMinLine: true,\n      ShowRightAxis: true,\n      ShowTooltips: true,\n      ShowValues: true,\n      SortColName: 'value',\n      SortDirection: 'ascending',\n      TZOffsetHours: 0,\n      ValueColName: 'value',\n      ValueDecimals: 2,\n      ValueColor: 'white',\n      ValueFontSize: '100%',\n      OddRowColor: 'rgba(33, 33, 34, 0.92)',\n      EvenRowColor: 'rgba(61, 61, 64, 0.78)',\n      GroupSortString: '',\n    };\n\n    var panel = {};\n    var elem = {};\n    var ctrl = {};\n\n    _.defaults(this.panel, panelDefaults);\n\n    this.events.on('render', this.onRender.bind(this));\n    this.events.on('data-received', this.onDataReceived.bind(this));\n    this.events.on('data-error', this.onDataError.bind(this));\n    this.events.on('init-edit-mode', this.onInitEditMode.bind(this));\n  }\n\n  onDataError(err) {\n    this.alertSrv.set('Multistat Data Error', err, 'error', 5000);\n    this.seriesList = [];\n    this.render([]);\n  }\n\n  onInitEditMode() {\n    this.metricNames = ['min', 'max', 'avg', 'current', 'total', 'name', 'first', 'delta', 'diff', 'range'];\n    this.sortDirections = ['none', 'ascending', 'decending'];\n    this.fontSizes = ['20%', '30%', '50%', '70%', '80%', '100%', '110%', '120%', '150%', '170%', '200%'];\n    this.addEditorTab('Columns', 'public/plugins/michaeldmoore-multistat-panel/columns.html', 2);\n    this.addEditorTab('Layout', 'public/plugins/michaeldmoore-multistat-panel/layout.html', 3);\n    this.addEditorTab('Lines & Limits', 'public/plugins/michaeldmoore-multistat-panel/linesandlimits.html', 4);\n  }\n\n  buildDateHtml(dateTimeCol) {\n    var $title = this.elem.closest('.panel-container').find('.panel-title');\n    var $maxDate = $title.find('span.michaeldmoore-multistat-panel-maxDate');\n\n    if ($maxDate.length == 0)\n      $maxDate = $title\n        .append('<span class=\"michaeldmoore-multistat-panel-maxDate\"/>')\n        .children()\n        .last();\n\n    if (dateTimeCol != -1 && this.panel.ShowDate) {\n      var maxDate = this.rows[0][dateTimeCol];\n\n      for (var i = 1; i < this.rows.length; i++) {\n        if (maxDate < this.rows[i][dateTimeCol]) maxDate = this.rows[i][dateTimeCol];\n      }\n\n      var dd = moment(maxDate).add(this.panel.TZOffsetHours, 'h');\n\n      if (this.panel.DateFormat.toUpperCase() == 'ELAPSED') $maxDate.text(dd.fromNow()).show();\n      else $maxDate.text(dd.format(this.panel.DateFormat)).show();\n    } else $maxDate.hide();\n  }\n\n  onRender() {\n    if (this.data != null) {\n      var cols = this.cols;\n      var dateTimeCol = -1;\n      var labelCol = -1;\n      var valueCol = 0;\n      var sortCol = 0;\n      var groupCol = -1;\n      for (var i = 0; i < cols.length; i++) {\n        if (cols[i] == this.panel.DateTimeColName) dateTimeCol = i;\n        if (cols[i] == this.panel.LabelColName) labelCol = i;\n        if (cols[i] == this.panel.ValueColName) valueCol = i;\n        if (cols[i] == this.panel.SortColName) sortCol = i;\n        if (cols[i] == this.panel.GroupColName) groupCol = i;\n      }\n\n      if (this.panel.FilterMultiples && labelCol != -1) {\n        var oo = [];\n        //this.rows = [];\n        d3\n          .nest()\n          .key(function(d) {\n            return d[labelCol];\n          })\n          .rollup(function(d) {\n            return d[d.length - 1];\n          })\n          .entries(this.data.rows)\n          .forEach(function(x) {\n            //this.rows.push(x.value);\n            oo.push(x.value);\n          });\n        this.rows = oo;\n      } else {\n        this.rows = this.data.rows;\n      }\n\n      var className = 'michaeldmoore-multistat-panel-' + this.panel.id;\n      this.elem.html(\"<svg class='\" + className + \"'  style='height:\" + this.ctrl.height + \"px; width:100%'></svg>\");\n      var $container = this.elem.find('.' + className);\n\n      var h = $container.height();\n      var w = $container.width() - 15;\n\n      if (this.panel.SortDirection != 'none') {\n        var ascending = this.panel.SortDirection == 'ascending';\n        this.rows.sort(function(x, y) {\n          var comp = x[sortCol] == y[sortCol] ? 0 : x[sortCol] > y[sortCol] ? 1 : -1;\n          return ascending ? comp : -comp;\n        });\n      }\n\n      this.buildDateHtml(dateTimeCol);\n\n      var horizontal = this.panel.Horizontal;\n\n      var labelMargin =\n        $.isNumeric(this.panel.LabelMargin) && this.panel.LabelMargin >= 0\n          ? this.panel.LabelMargin\n          : horizontal ? 100 : 20;\n      var lowSideMargin = this.panel.LowSideMargin >= 0 ? this.panel.LowSideMargin : 0;\n      var highSideMargin = this.panel.HighSideMargin >= 0 ? this.panel.HighSideMargin : 0;\n\n      var svg = d3.select('.' + className).append('svg');\n\n      var barPadding = this.panel.BarPadding;\n      var baseLineValue = this.panel.BaseLineValue;\n      var minLineValue = this.panel.MinLineValue;\n      var maxLineValue = this.panel.MaxLineValue;\n      var highBarColor = this.panel.HighBarColor;\n      var lowBarColor = this.panel.LowBarColor;\n      var highLimitValue = this.panel.HighLimitValue;\n      var HighLimitBarColor = this.panel.HighLimitBarColor;\n      var HighLimitBarFlashColor = this.panel.HighLimitBarFlashColor;\n      var HighLimitBarFlashTimeout = this.panel.HighLimitBarFlashTimeout;\n      var recolorHighLimitBar = this.panel.RecolorHighLimitBar;\n      var lowLimitValue = this.panel.LowLimitValue;\n      var LowLimitBarColor = this.panel.LowLimitBarColor;\n      var LowLimitBarFlashColor = this.panel.LowLimitBarFlashColor;\n      var LowLimitBarFlashTimeout = this.panel.LowLimitBarFlashTimeout;\n      var recolorLowLimitBar = this.panel.RecolorLowLimitBar;\n      var flashHighLimitBar = this.panel.FlashHighLimitBar;\n      var flashLowLimitBar = this.panel.FlashLowLimitBar;\n      var showTooltips = this.panel.ShowTooltips;\n      var DateTimeColName = this.panel.DateTimeColName;\n      var DateFormat = this.panel.DateFormat;\n      var TooltipDateFormat = this.panel.TooltipDateFormat;\n      var ValueColName = this.panel.ValueColName;\n      var ValueDecimals = this.panel.ValueDecimals;\n      var OddRowColor = this.panel.OddRowColor;\n      var EvenRowColor = this.panel.EvenRowColor;\n      var TZOffsetHours = this.panel.TZOffsetHours;\n      var GroupSortString = this.panel.GroupSortString;\n\n      if ($.isNumeric(HighLimitBarFlashTimeout) == false) HighLimitBarFlashTimeout = 200;\n\n      if ($.isNumeric(LowLimitBarFlashTimeout) == false) LowLimitBarFlashTimeout = 200;\n\n      var minValue = d3.min(this.rows, function(d) {\n        return Number(d[valueCol]);\n      });\n      if ($.isNumeric(minLineValue) == false || minLineValue > minValue) minLineValue = minValue;\n\n      var maxValue = d3.max(this.rows, function(d) {\n        return Number(d[valueCol]);\n      });\n      if ($.isNumeric(maxLineValue) == false || maxLineValue < maxValue) maxLineValue = maxValue;\n\n      if ($.isNumeric(baseLineValue) == false) baseLineValue = 0;\n\n      if (minLineValue > baseLineValue) minLineValue = baseLineValue;\n\n      if ($.isNumeric(lowLimitValue) && minLineValue > lowLimitValue) minLineValue = lowLimitValue;\n\n      if (maxLineValue < baseLineValue) maxLineValue = baseLineValue;\n\n      if ($.isNumeric(highLimitValue) && maxLineValue < highLimitValue) maxLineValue = highLimitValue;\n\n      var cc1 = d3.select('body');\n      var cc2 = cc1.selectAll('.michaeldmoore-multistat-panel-tooltip-' + this.panel.id);\n      cc2.remove();\n\n      var tooltipDiv = d3\n        .select('body')\n        .append('div')\n        .attr('class', 'michaeldmoore-multistat-panel-tooltip michaeldmoore-multistat-panel-tooltip-' + this.panel.id)\n        .style('opacity', 0);\n\n      var tooltipShow = function(d, c) {\n        tooltipDiv\n          .transition()\n          .duration(200)\n          .style('opacity', 0.9);\n        var html = '<table>';\n        for (i = 0; i < d.length; i++) {\n          var cc = c[i];\n          var dd = d[i];\n\n          if (cc == DateTimeColName)\n            dd = moment(dd)\n              .add(TZOffsetHours, 'h')\n              .format(TooltipDateFormat);\n          else if (cc == ValueColName && $.isNumeric(dd)) dd = dd.toFixed(ValueDecimals);\n\n          html += '<tr><td>' + cc + '</td><td>' + dd + '</td></tr>';\n        }\n        html += '</table>';\n        tooltipDiv\n          .html(html)\n          .style('left', d3.event.pageX + 'px')\n          .style('top', d3.event.pageY - 28 + 'px');\n      };\n\n      var tooltipHide = function() {\n        tooltipDiv\n          .transition()\n          .duration(500)\n          .style('opacity', 0);\n      };\n\n      if (horizontal) {\n        var plotGroupHorizontal = function(panel, data, numRows, groupName, left, w) {\n          var groupNameOffset = groupName != '' ? 15 : 0;\n          lowSideMargin += groupNameOffset;\n\n          var valueScale = d3\n            .scaleLinear()\n            .domain([minLineValue, maxLineValue])\n            .range([left + labelMargin, w])\n            .nice();\n\n          var labels = data.map(function(d) {\n            return d[labelCol];\n          });\n          while (labels.length < numRows)\n            labels = labels.concat(\n              '_' +\n                Math.random()\n                  .toString(36)\n                  .substr(2, 9)\n            );\n\n          var labelScale = d3\n            .scaleBand()\n            .domain(labels)\n            .rangeRound([lowSideMargin, h - highSideMargin])\n            .padding(barPadding / 100);\n\n          // Draw background of alternating stripes\n          var oddeven = false;\n          svg\n            .append('g')\n            .selectAll('rect')\n            .data(data)\n            .enter()\n            .append('rect')\n            .attr('class', 'michaeldmoore-multistat-panel-row')\n            .attr('width', w)\n            .attr('height', labelScale.bandwidth())\n            .attr('x', left)\n            .attr('y', function(d, i) {\n              return labelScale(d[labelCol]);\n            })\n            .attr('fill', function(d) {\n              oddeven = !oddeven;\n              return oddeven ? OddRowColor : EvenRowColor;\n            });\n\n          function vLine(value, color) {\n            svg\n              .append('line')\n              .style('stroke', color)\n              .attr('y1', lowSideMargin)\n              .attr('x1', valueScale(value))\n              .attr('y2', h - highSideMargin)\n              .attr('x2', valueScale(value));\n          }\n\n          if (panel.ShowBaseLine) vLine(baseLineValue, panel.BaseLineColor);\n\n          if (panel.ShowMaxLine) vLine(maxLineValue, panel.MaxLineColor);\n\n          if (panel.ShowMinLine) vLine(minLineValue, panel.MinLineColor);\n\n          if (panel.ShowHighLimitLine) vLine(highLimitValue, panel.HighLimitLineColor);\n\n          if (panel.ShowLowLimitLine) vLine(lowLimitValue, panel.LowLimitLineColor);\n\n          svg\n            .append('g')\n            .selectAll('rect')\n            .data(data)\n            .enter()\n            .append('rect')\n            .attr('class', 'michaeldmoore-multistat-panel-bar')\n            .attr('width', function(d) {\n              var ww = valueScale(d[valueCol]) - valueScale(baseLineValue);\n              if (ww < 0) ww = -ww;\n              return ww;\n            })\n            .attr('height', labelScale.bandwidth())\n            .attr('x', function(d) {\n              return d3.min([valueScale(d[valueCol]), valueScale(baseLineValue)]);\n            })\n            .attr('y', function(d, i) {\n              return labelScale(d[labelCol]);\n            })\n            .attr('fill', function(d) {\n              if (recolorHighLimitBar && d[valueCol] > highLimitValue) return HighLimitBarColor;\n              if (recolorLowLimitBar && d[valueCol] < lowLimitValue) return LowLimitBarColor;\n              return d[valueCol] > baseLineValue ? highBarColor : lowBarColor;\n            })\n            .classed('highflash', function(d) {\n              return recolorHighLimitBar && flashHighLimitBar && d[valueCol] > highLimitValue;\n            })\n            .classed('lowflash', function(d) {\n              return recolorLowLimitBar && flashLowLimitBar && d[valueCol] < lowLimitValue;\n            })\n            .on('mouseover', function(d) {\n              if (showTooltips) tooltipShow(d, cols);\n            })\n            .on('mouseout', function() {\n              tooltipHide();\n            });\n\n          var g = svg\n            .append('g')\n            .selectAll('text')\n            .data(data)\n            .enter()\n            .append('g');\n\n          if (panel.ShowValues) {\n            g\n              .append('text')\n              //.text(function(d) {return formatDecimal(d[valueCol])})\n              .text(function(d) {\n                return d[valueCol].toFixed(ValueDecimals);\n              })\n              .attr('x', function(d) {\n                return valueScale(d[valueCol]) + (d[valueCol] > baseLineValue ? -5 : +5);\n              })\n              .attr('y', function(d, i) {\n                return labelScale(d[labelCol]) + labelScale.bandwidth() / 2;\n              })\n              .attr('font-family', 'sans-serif')\n              .attr('font-size', panel.ValueFontSize)\n              .attr('fill', panel.ValueColor)\n              .attr('text-anchor', function(d) {\n                return d[valueCol] > baseLineValue ? 'end' : 'start';\n              })\n              .attr('dominant-baseline', 'central');\n          }\n\n          if (panel.ShowLabels) {\n            g\n              .append('text')\n              .text(function(d) {\n                return d[labelCol];\n              })\n              .attr('x', left + labelMargin - 5)\n              .attr('y', function(d, i) {\n                return labelScale(d[labelCol]) + labelScale.bandwidth() / 2;\n              })\n              .attr('font-family', 'sans-serif')\n              .attr('font-size', panel.LabelFontSize)\n              .attr('fill', panel.LabelColor)\n              .attr('text-anchor', 'end')\n              .attr('dominant-baseline', 'central');\n          }\n\n          // Add Low Side Group Names\n          if (groupName != '') {\n            svg\n              .append('text')\n              .text(groupName)\n              .attr('x', left + (labelMargin + w - left) / 2 - 5)\n              .attr('y', 5)\n              .attr('font-family', 'sans-serif')\n              .attr('font-size', panel.LabelFontSize)\n              .attr('fill', panel.LabelColor)\n              .attr('text-anchor', 'middle')\n              .attr('dominant-baseline', 'central');\n          }\n\n          //Add Low Side Value Axis (X)\n          if (lowSideMargin > groupNameOffset) {\n            var gg = svg\n              .append('g')\n              .attr('transform', 'translate(0,' + lowSideMargin + ')')\n              .attr('class', 'michaeldmoore-multistat-panel-valueaxis')\n              .call(d3.axisTop(valueScale));\n            gg.selectAll('.tick text').attr('fill', panel.LowAxisColor);\n            gg.selectAll('.tick line').attr('stroke', panel.LowAxisColor);\n            gg.selectAll('path.domain').attr('stroke', panel.LowAxisColor);\n          }\n\n          //Add High Side Value Axis (X)\n          if (highSideMargin > 0) {\n            var gg = svg\n              .append('g')\n              .attr('transform', 'translate(0,' + (h - highSideMargin) + ')')\n              .attr('class', 'michaeldmoore-multistat-panel-valueaxis')\n              .call(d3.axisBottom(valueScale));\n            gg.selectAll('.tick text').attr('fill', panel.HighAxisColor);\n            gg.selectAll('.tick line').attr('stroke', panel.HighAxisColor);\n            gg.selectAll('path.domain').attr('stroke', panel.HighAxisColor);\n          }\n\n          lowSideMargin -= groupNameOffset;\n        };\n\n        if (groupCol >= 0) {\n          this.groupedRows = d3\n            .nest()\n            .key(function(d) {\n              return d[groupCol];\n            })\n            .entries(this.rows);\n\n          this.groupedRows.sort(function(a, b) {\n            var aPos = GroupSortString.search(a.key);\n            var bPos = GroupSortString.search(b.key);\n\n            if (aPos == bPos) return a.key.localeCompare(b.key);\n            else return aPos - bPos;\n          });\n\n          var gap = 5;\n          var dw = (w + gap) / this.groupedRows.length;\n          var numRows = d3.max(this.groupedRows, function(d) {\n            return d.values.length;\n          });\n\n          for (var i = 0; i < this.groupedRows.length; i++)\n            plotGroupHorizontal(\n              this.panel,\n              this.groupedRows[i].values,\n              numRows,\n              this.groupedRows[i].key,\n              i * dw,\n              i * dw + dw - gap\n            );\n        } else {\n          this.groupedRows = null;\n\n          plotGroupHorizontal(this.panel, this.rows, this.rows.length, '', 0, w);\n        }\n      } else {\n        var valueScale = d3\n          .scaleLinear()\n          .domain([maxLineValue, minLineValue])\n          .range([10, h - labelMargin])\n          .nice();\n\n        var labelScale = d3\n          .scaleBand()\n          .domain(\n            this.rows.map(function(d) {\n              return d[labelCol];\n            })\n          )\n          .range([lowSideMargin, w - highSideMargin])\n          .padding(barPadding / 100);\n\n        // Draw background of alternating stripes\n        var oddeven = false;\n        svg //.append(\"g\")\n          .selectAll('rect')\n          .data(this.rows)\n          .enter()\n          .append('rect')\n          .attr('class', 'michaeldmoore-multistat-panel-row')\n          .attr('width', labelScale.bandwidth())\n          .attr('height', h)\n          .attr('x', function(d, i) {\n            return labelScale(d[labelCol]);\n          })\n          .attr('y', 0)\n          .attr('fill', function(d) {\n            oddeven = !oddeven;\n            return oddeven ? OddRowColor : EvenRowColor;\n          });\n\n        function hLine(value, color) {\n          svg\n            .append('line')\n            .style('stroke', color)\n            .attr('x1', lowSideMargin)\n            .attr('y1', valueScale(value))\n            .attr('x2', w - highSideMargin)\n            .attr('y2', valueScale(value));\n        }\n\n        if (this.panel.ShowBaseLine) hLine(baseLineValue, this.panel.BaseLineColor);\n\n        if (this.panel.ShowMaxLine) hLine(maxLineValue, this.panel.MaxLineColor);\n\n        if (this.panel.ShowMinLine) hLine(minLineValue, this.panel.MinLineColor);\n\n        if (this.panel.ShowHighLimitLine) hLine(highLimitValue, this.panel.HighLimitLineColor);\n\n        if (this.panel.ShowLowLimitLine) hLine(lowLimitValue, this.panel.LowLimitLineColor);\n\n        svg\n          .append('g')\n          .selectAll('rect')\n          .data(this.rows)\n          .enter()\n          .append('rect')\n          .attr('class', 'michaeldmoore-multistat-panel-bar')\n          .attr('height', function(d) {\n            var hh = valueScale(d[valueCol]) - valueScale(baseLineValue);\n            if (hh < 0) hh = -hh;\n            return hh;\n          })\n          .attr('width', labelScale.bandwidth())\n          .attr('y', function(d) {\n            return d3.min([valueScale(d[valueCol]), valueScale(baseLineValue)]);\n          })\n          .attr('x', function(d, i) {\n            return labelScale(d[labelCol]);\n          })\n          .attr('fill', function(d) {\n            if (recolorHighLimitBar && d[valueCol] > highLimitValue) return HighLimitBarColor;\n            if (recolorLowLimitBar && d[valueCol] < lowLimitValue) return LowLimitBarColor;\n            return d[valueCol] > baseLineValue ? highBarColor : lowBarColor;\n          })\n          .classed('highflash', function(d) {\n            return recolorHighLimitBar && flashHighLimitBar && d[valueCol] > highLimitValue;\n          })\n          .classed('lowflash', function(d) {\n            return recolorLowLimitBar && flashLowLimitBar && d[valueCol] < lowLimitValue;\n          })\n          .on('mouseover', function(d) {\n            if (showTooltips) tooltipShow(d, cols);\n          })\n          .on('mouseout', function() {\n            tooltipHide();\n          });\n\n        var g = svg\n          .selectAll('text')\n          .data(this.rows)\n          .enter()\n          .append('g');\n\n        if (this.panel.ShowValues) {\n          g\n            .append('text')\n            .text(function(d) {\n              return d[valueCol].toFixed(ValueDecimals);\n            })\n            .attr('x', function(d, i) {\n              return labelScale(d[labelCol]) + labelScale.bandwidth() / 2;\n            })\n            .attr('y', function(d) {\n              return valueScale(d[valueCol]) + (d[valueCol] > baseLineValue ? 5 : -5);\n            })\n            .attr('font-family', 'sans-serif')\n            .attr('font-size', this.panel.ValueFontSize)\n            .attr('fill', this.panel.ValueColor)\n            .attr('text-anchor', 'middle')\n            .attr('dominant-baseline', function(d) {\n              return d[valueCol] > baseLineValue ? 'text-before-edge' : 'text-after-edge';\n            });\n        }\n\n        if (this.panel.ShowLabels) {\n          g\n            .append('text')\n            .text(function(d) {\n              return d[labelCol];\n            })\n            .attr('x', function(d, i) {\n              return labelScale(d[labelCol]) + labelScale.bandwidth() / 2;\n            })\n            .attr('y', function(d) {\n              return h - labelMargin + 14;\n            })\n            .attr('font-family', 'sans-serif')\n            .attr('font-size', this.panel.LabelFontSize)\n            .attr('fill', this.panel.LabelColor)\n            .attr('text-anchor', 'middle');\n        }\n\n        if (lowSideMargin > 0) {\n          var gg = svg\n            .append('g')\n            .attr('transform', 'translate(' + lowSideMargin + ', 0)')\n            .classed('michaeldmoore-multistat-panel-valueaxis', true)\n            .call(\n              d3\n                .axisLeft(valueScale)\n                .tickSizeInner(5)\n                .tickSizeOuter(10)\n                .ticks(5)\n            );\n          gg.selectAll('.tick text').attr('fill', this.panel.LowAxisColor);\n          gg.selectAll('.tick line').attr('stroke', this.panel.LowAxisColor);\n          gg.selectAll('path.domain').attr('stroke', this.panel.LowAxisColor);\n        }\n\n        if (highSideMargin > 0) {\n          var gg = svg\n            .append('g')\n            .attr('transform', 'translate(' + (w - highSideMargin) + ', 0)')\n            .classed('michaeldmoore-multistat-panel-valueaxis', true)\n            .call(\n              d3\n                .axisRight(valueScale)\n                .tickSizeInner(5)\n                .tickSizeOuter(10)\n                .ticks(5)\n            );\n          gg.selectAll('.tick text').attr('fill', this.panel.HighAxisColor);\n          gg.selectAll('.tick line').attr('stroke', this.panel.HighAxisColor);\n          gg.selectAll('path.domain').attr('stroke', this.panel.HighAxisColor);\n        }\n      }\n\n      function pulse() {\n        var highFlashRects = svg.selectAll('rect.michaeldmoore-multistat-panel-bar.highflash');\n        (function highRepeat() {\n          highFlashRects\n            .transition()\n            .duration(HighLimitBarFlashTimeout)\n            .attr('fill', HighLimitBarColor)\n            .transition()\n            .duration(HighLimitBarFlashTimeout)\n            .attr('fill', HighLimitBarFlashColor)\n            .on('end', highRepeat);\n        })();\n\n        var lowFlashRects = svg.selectAll('rect.michaeldmoore-multistat-panel-bar.lowflash');\n        (function lowRepeat() {\n          lowFlashRects\n            .transition()\n            .duration(LowLimitBarFlashTimeout)\n            .attr('fill', LowLimitBarColor)\n            .transition()\n            .duration(LowLimitBarFlashTimeout)\n            .attr('fill', LowLimitBarFlashColor)\n            .on('end', lowRepeat);\n        })();\n      }\n\n      pulse();\n    }\n\n    this.ctrl.renderingCompleted();\n  }\n\n  onDataReceived(data) {\n    this.cols = [];\n    if (data.length == 0) {\n      this.elem.html(\n        \"<div style='position:absolute;top:50%;text-align:center;font-size:0.875rem;'>No data to show</div>\"\n      );\n      this.data = data;\n      this.rows = null;\n    } else if (data[0].type == 'table') {\n      this.data = data[0];\n\n      for (var i = 0; i < this.data.columns.length; i++) this.cols[i] = this.data.columns[i].text;\n      this.cols0 = [''].concat(this.cols);\n\n      this.render();\n    } else {\n      this.alertSrv.set('Multistat Data Error', 'Query type \"' + dataList[0].Type + '\", not supported', 'error', 5000);\n    }\n  }\n\n  onConfigChanged() {\n    this.refresh();\n  }\n\n  link(scope, elem, attrs, ctrl) {\n    this.ctrl = ctrl;\n    this.elem = elem.find('.panel-content');\n  }\n}\n\nMultistatPanelCtrl.templateUrl = 'module.html';\n\nexport { MultistatPanelCtrl as PanelCtrl };\n"]}