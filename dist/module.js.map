{"version":3,"sources":["../src/module.js"],"names":["isNumber","n","isNaN","parseFloat","isFinite","MetricsPanelCtrl","$","_","moment","d3","getTemplateSrv","PanelEvents","templateSrv","MultistatPanelCtrl","$scope","$injector","panelDefaults","timeFrom","timeShift","BarPadding","MultiBarPadding","BaseLineColor","BaseLineWidth","BaseLineValue","DateTimeColName","DateFormat","TooltipDateFormat","FlashHighLimitBar","FlashLowLimitBar","HighAxisColor","HighAxisWidth","HighBarColor","RecolorColName","HighLimitBarColor","HighLimitBarFlashColor","HighLimitBarFlashTimeout","HighLimitLineColor","HighLimitValue","HighLmitLineWidth","HighSideMargin","Horizontal","LabelColName","LabelNameFilter","LabelColor","OutOfRangeLabelColor","GroupLabelColor","LabelFontSize","GroupRenamingRules","GroupLabelFontSize","GroupGap","VGroupGap","LabelRenamingRules","LabelMargin","Legend","Links","LowAxisColor","LowAxisWidth","LowBarColor","LowLimitBarColor","LowLimitBarFlashColor","LowLimitBarFlashTimeout","LowLimitLineColor","LowLimitValue","LowLmitLineWidth","LowSideMargin","MaxLineColor","MaxLineWidth","MaxLineValue","MinLineColor","MinLineWidth","MinLineValue","RecolorHighLimitBar","RecolorLowLimitBar","RecolorRules","ShowBaseLine","ShowDate","Aggregate","ShowHighLimitLine","ShowLabels","ShowGroupLabels","ShowLeftAxis","ShowLowLimitLine","ShowMaxLine","ShowMinLine","ShowRightAxis","ShowValues","SortColName","SortDirection","TZOffsetHours","ToolTipType","ToolTipFontSize","ValueColName","Values","ValueDecimals","ValueColor","ValueFontSize","OddRowColor","EvenRowColor","OutlineColor","GroupSortString","GroupCols","GroupNameFilter","ScaleFactor","ValuePosition","LableAngle","ShowBars","ShowLines","LineWidth","LineColor","DotSize","DotColor","CurveType","defaults","panel","length","Name","Selected","dashboardVariables","getVariables","forEach","v","current","push","name","value","events","on","dataReceived","onDataReceived","bind","dataError","onDataError","render","onRender","dataSnapshotLoad","onDataSnapshotLoad","editModeInitialized","onInitEditMode","className","id","obj","names","shift","updateNamedValue","Number","snapshotData","err","seriesList","data","displayStatusMessage","status","statusText","metricNames","sortDirections","aggregations","fontSizes","valuePositions","curveTypes","matchTypes","tooltipTypes","addEditorTab","cols","rows","columns","i","text","cols0","concat","letters","split","color","Math","floor","random","hexcolor","match","exec","r","parseInt","g","b","brightness","contrastingColor","r1","g1","b1","ctrl","randomColor","index","up","splice","dateTimeCol","$title","elem","closest","find","$maxDate","append","children","last","maxDate","dd","add","toUpperCase","fromNow","show","format","hide","msg","html","rules","newName","rule","enabled","regex","RegExp","from","replaceAll","to","labelCol","sortCol","groupCol","recolorCol","range","timeSrv","timeRangeForUrl","colName","GroupColName","Value","Col","SelectedValues","filter","renamedRows","map","row","renamedRow","parsedDateTime","_isValid","timeStamp","unix","utc","processRenamingRules","groupedLabelFunc","label","groupNameOffset","replace","groupedRows","Array","group","d","regexGroupRows","matchingGroups","groupName","groupSortString","sort","a","aPos","search","bPos","localeCompare","x$","select","remove","$container","svg","attr","$legend","legendValues","deselectedClassName","css","getContrastingColor","click","window","event","ctrlKey","CTRL","$apply","h","height","w","width","buildDateHtml","labelMargin","lowSideMargin","highSideMargin","selectAll","interrupt","barPadding","multiBarPadding","baseLineValue","minLineValue","maxLineValue","highLimitValue","recolorHighLimitBar","lowLimitValue","recolorLowLimitBar","flashHighLimitBar","flashLowLimitBar","tooltipType","tooltipFontSize","panelID","tooltipDivID","minValue","min","col","val","maxValue","max","sortData","sortDirection","ascending","x","y","xx","yy","aggregateData","aggregate","Object","values","assign","sum","mean","translateValues","s","s1","re","j","dv","getTooltipContent","isArray","cc","toFixed","l","url","newtab","isInTooltip","$panel","$panelContent","panelContent","tooltipShow","parent","style","tooltipDiv","tooltipHtml","classed","tooltipHide","$tooltipDiv","tooltipWidth","tooltipHeight","minTop","mouseCoordinates","mouse","node","Left","Top","panelWidth","panelHeight","transition","duration","cancel","scaleAndClipValue","getBarColor","valueDef","recolorString","recolorRule","pattern","matchType","test","indexOf","Option","getValueColor","barColor","valueColor","plotGroupHorizontal","numRows","left","hh","dh","labels","toString","substr","labelScale","scaleBand","domain","rangeRound","paddingInner","paddingOuter","stripedata","stripeScale","oddeven","enter","step","maxValueWidth","valueCol","gap","bandwidth","each","thisWidth","getComputedTextLength","maxLabelWidth","labelAngle","minvalue","maxvalue","bbox","getBBox","sin","PI","c","cos","abs","valueScale","scaleLinear","nice","vLine","strokeWidth","HighLimitLineWidth","LowLimitLineWidth","bw","curveFunc","curveLinear","curveMonotoneY","curveCardinal","curveCatmullRom","lineFunction","line","curve","points","ggHighSide","call","axisTop","ggLowSide","axisBottom","gcols","dw","pointsPerRow","rr","u","totalPoints","rowOverheadHeight","rowHeight","ceil","nn","ii","plotGroupVertical","g2","maxValueHeight","thisHeight","maxLabelHeight","hLine","curveMonotoneX","axisLeft","tickSizeInner","tickSizeOuter","ticks","axisRight","pointsPerCol","colOverheadWidth","colWidth","ww","pulseHigh","highFlashRects","_groups","highRepeat","active","pulseLow","lowFlashRects","lowRepeat","renderingCompleted","refresh","scope","attrs","panelContentElem","templateUrl"],"mappings":"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","file":"module.js","sourcesContent":["/*jshint esversion: 6 */\r\n/*jshint -W087 */\r\n/*jshint -W014 */\r\nimport { MetricsPanelCtrl } from \"app/plugins/sdk\";\r\nimport $ from \"jquery\";\r\nimport \"jquery.flot\";\r\nimport _ from \"lodash\";\r\nimport moment from \"moment\";\r\nimport \"./css/multistat-panel.css!\";\r\nimport * as d3 from \"d3\";\r\nimport { getTemplateSrv } from '@grafana/runtime';\r\nimport { PanelEvents } from \"@grafana/data\";\r\n\r\nconst templateSrv = getTemplateSrv();\r\n\r\nfunction isNumber(n) {\r\n  return !isNaN(parseFloat(n)) && isFinite(n);\r\n}\r\n\r\nclass MultistatPanelCtrl extends MetricsPanelCtrl {\r\n  /** @ngInject */\r\n  constructor($scope, $injector) {\r\n    super($scope, $injector);\r\n\r\n    var panelDefaults = {\r\n      timeFrom: null,\r\n      timeShift: null,\r\n      BarPadding: 10,\r\n      MultiBarPadding: 10,\r\n      BaseLineColor: \"#ff0000\",\r\n      BaseLineWidth: 1,\r\n      BaseLineValue: null,\r\n      DateTimeColName: \"date\",\r\n      DateFormat: \"YYYY-MM-DD HH:mm:ss\",\r\n      TooltipDateFormat: \"YYYY-MM-DD HH:mm:ss\",\r\n      FlashHighLimitBar: false,\r\n      FlashLowLimitBar: false,\r\n      HighAxisColor: \"#ffffff\",\r\n      HighAxisWidth: 1,\r\n      HighBarColor: \"rgb(120, 128, 0)\",\r\n      RecolorColName: null,\r\n      HighLimitBarColor: \"#ff0000\",\r\n      HighLimitBarFlashColor: \"#ffa500\",\r\n      HighLimitBarFlashTimeout: 1000,\r\n      HighLimitLineColor: \"#ff0000\",\r\n      HighLimitValue: null,\r\n      HighLmitLineWidth: 1,\r\n      HighSideMargin: 22,\r\n      Horizontal: false,\r\n      LabelColName: \"\",\r\n      LabelNameFilter: \"\",\r\n      LabelColor: \"#ffffff\",\r\n      OutOfRangeLabelColor: \"#ffffff\",\r\n      GroupLabelColor: \"#ffffff\",\r\n      LabelFontSize: \"100%\",\r\n      GroupRenamingRules: [],\r\n      GroupLabelFontSize: \"200%\",\r\n      GroupGap: 5,\r\n      VGroupGap: 5,\r\n      LabelRenamingRules: [],\r\n      LabelMargin: null,\r\n      Legend: false,\r\n      Links: [],\r\n      LowAxisColor: \"#ffffff\",\r\n      LowAxisWidth: 1,\r\n      LowBarColor: \"teal\",\r\n      LowLimitBarColor: \"#ff0000\",\r\n      LowLimitBarFlashColor: \"#ffa500\",\r\n      LowLimitBarFlashTimeout: 200,\r\n      LowLimitLineColor: \"#ff0000\",\r\n      LowLimitValue: null,\r\n      LowLmitLineWidth: 1,\r\n      LowSideMargin: 22,\r\n      MaxLineColor: \"rgb(74, 232, 12)\",\r\n      MaxLineWidth: 1,\r\n      MaxLineValue: null,\r\n      MinLineColor: \"#ff0000\",\r\n      MinLineWidth: 1,\r\n      MinLineValue: null,\r\n      RecolorHighLimitBar: false,\r\n      RecolorLowLimitBar: false,\r\n      RecolorRules: [],\r\n      ShowBaseLine: false,\r\n      ShowDate: false,\r\n      Aggregate: \"last\",\r\n      ShowHighLimitLine: false,\r\n      ShowLabels: true,\r\n      ShowGroupLabels: true,\r\n      ShowLeftAxis: true,\r\n      ShowLowLimitLine: false,\r\n      ShowMaxLine: false,\r\n      ShowMinLine: false,\r\n      ShowRightAxis: true,\r\n      ShowValues: true,\r\n      SortColName: \"value\",\r\n      SortDirection: \"ascending\",\r\n      TZOffsetHours: 0,\r\n      ToolTipType: \"\",\r\n      ToolTipFontSize: \"100%\",\r\n      ValueColName: \"\",\r\n      Values: [],\r\n      ValueDecimals: 2,\r\n      ValueColor: \"#ffffff\",\r\n      ValueFontSize: \"100%\",\r\n      OddRowColor: \"rgba(33, 33, 34, 0.92)\",\r\n      EvenRowColor: \"rgba(61, 61, 64, 0.78)\",\r\n      OutlineColor: \"rgba(245, 255, 0, 0.1)\",\r\n      GroupSortString: \"\",\r\n      GroupCols: 0,\r\n      GroupNameFilter: \"\",\r\n      ScaleFactor: 1,\r\n      ValuePosition: \"top\",\r\n      LableAngle: 0,\r\n      ShowBars: true,\r\n      ShowLines: false,\r\n      LineWidth: 5,\r\n      LineColor: \"blue\",\r\n      DotSize: 10,\r\n      DotColor: \"white\",\r\n      CurveType: \"Monotone\",\r\n    };\r\n\r\n    _.defaults(this.panel, panelDefaults);\r\n\r\n    // Migrate old configurations from single value column to array of value columns\r\n    if (this.panel.Values.length === 0) {\r\n      this.panel.Values = [\r\n        {\r\n          Name: this.panel.ValueColName,\r\n          LowBarColor: this.panel.LowBarColor,\r\n          HighBarColor: this.panel.HighBarColor,\r\n          Selected: true\r\n        },\r\n      ];\r\n      delete this.panel.ValueColName;\r\n      delete this.panel.LowBarColor;\r\n      delete this.panel.HighBarColor;\r\n    }\r\n\r\n    this.dashboardVariables = [];\r\n    //console.log('Listing variables');\r\n    if (templateSrv) {\r\n      templateSrv.getVariables().forEach((v) => {\r\n        //console.log(JSON.stringify(v, null, 2));\r\n        if (v.current) {\r\n          //console.log(\"dashboard variable[\" + v.name + \"]=\" + v.current.value);\r\n          //this.updateNamedValue(this.panel, v.name.split(\"_\"), v.current.value);   ////// WHAT WAS THIS FOR?????\r\n          this.dashboardVariables.push({ name: v.name, value: v.current.value });\r\n        }\r\n      });\r\n    }\r\n\r\n    //console.log('this.dashboardVariables='+JSON.stringify(this.dashboardVariables, null, 2));\r\n\r\n    this.events.on(\r\n      PanelEvents.dataReceived,\r\n      this.onDataReceived.bind(this),\r\n      $scope\r\n    );\r\n\r\n    this.events.on(\r\n      PanelEvents.dataError,\r\n      this.onDataError.bind(this),\r\n      $scope\r\n    );\r\n\r\n    this.events.on(\r\n      PanelEvents.render,\r\n      this.onRender.bind(this)\r\n    );\r\n\r\n    this.events.on(\r\n      PanelEvents.dataSnapshotLoad,\r\n      this.onDataSnapshotLoad.bind(this)\r\n    );\r\n\r\n    this.events.on(\r\n      PanelEvents.editModeInitialized,\r\n      this.onInitEditMode.bind(this)\r\n    );\r\n\r\n    this.className = \"michaeldmoore-multistat-panel-\" + this.panel.id;\r\n  }\r\n\r\n  updateNamedValue(obj, names, value) {\r\n    let name = names.shift();\r\n    if (obj[name]) {\r\n      if (names.length) this.updateNamedValue(obj[name], names, value);\r\n      else obj[name] = Number(value);\r\n    }\r\n  }\r\n\r\n  onDataSnapshotLoad(snapshotData) {\r\n    this.onDataReceived(snapshotData);\r\n  }\r\n\r\n  onDataError(err) {\r\n    this.seriesList = [];\r\n    this.data = [];\r\n    this.displayStatusMessage(\r\n      \"Query failure, Status=\" + err.status + \", \" + err.statusText\r\n    );\r\n  }\r\n\r\n  onInitEditMode() {\r\n    this.metricNames = [\r\n      \"min\",\r\n      \"max\",\r\n      \"avg\",\r\n      \"current\",\r\n      \"total\",\r\n      \"name\",\r\n      \"first\",\r\n      \"delta\",\r\n      \"diff\",\r\n      \"range\",\r\n    ];\r\n    this.sortDirections = [\"none\", \"ascending\", \"descending\"];\r\n    this.aggregations = [\"all\", \"last\", \"first\", \"mean\", \"max\", \"min\", \"sum\"];\r\n    this.fontSizes = [\r\n      \"20%\",\r\n      \"30%\",\r\n      \"50%\",\r\n      \"70%\",\r\n      \"80%\",\r\n      \"100%\",\r\n      \"110%\",\r\n      \"120%\",\r\n      \"150%\",\r\n      \"170%\",\r\n      \"200%\",\r\n      \"250%\",\r\n      \"300%\",\r\n      \"350%\",\r\n      \"400%\",\r\n    ];\r\n    this.valuePositions = [\"bar base\", \"bar end\", \"top\"];\r\n    this.curveTypes = [\"Linear\", \"Monotone\", \"Cardinal\", \"Catmull-Rom\"];\r\n    this.matchTypes = [\"exact\", \"subset\", \"list\", \"reg-ex\"];\r\n    this.tooltipTypes = [\"light\", \"dark\"];\r\n    this.addEditorTab(\r\n      \"Columns\",\r\n      \"public/plugins/michaeldmoore-multistat-panel/columns.html\",\r\n      2\r\n    );\r\n    this.addEditorTab(\r\n      \"Layout\",\r\n      \"public/plugins/michaeldmoore-multistat-panel/layout.html\",\r\n      3\r\n    );\r\n    this.addEditorTab(\r\n      \"Grouping\",\r\n      \"public/plugins/michaeldmoore-multistat-panel/grouping.html\",\r\n      4\r\n    );\r\n    this.addEditorTab(\r\n      \"Options\",\r\n      \"public/plugins/michaeldmoore-multistat-panel/options.html\",\r\n      5\r\n    );\r\n    this.addEditorTab(\r\n      \"Lines-and-Limits\",\r\n      \"public/plugins/michaeldmoore-multistat-panel/linesandlimits.html\",\r\n      6\r\n    );\r\n    this.addEditorTab(\r\n      \"Bar links\",\r\n      \"public/plugins/michaeldmoore-multistat-panel/barlinks.html\",\r\n      7\r\n    );\r\n  }\r\n\r\n  onDataReceived(data) {\r\n    this.cols = [];\r\n    //console.log('onDataReceived(' + JSON.stringify(data, null, 2) + ')');\r\n    if (data.length == 0 || data[0].rows.length == 0) {\r\n      this.displayStatusMessage(\"No data to show\");\r\n      this.data = data;\r\n      this.rows = null;\r\n      this.render();\r\n    } else if (/*data[0].type == \"table\" || */data[0].columns) {\r\n      this.data = data[0];\r\n\r\n      for (let i = 0; i < this.data.columns.length; i++)\r\n        this.cols[i] = this.data.columns[i].text;\r\n      this.cols0 = [\"\"].concat(this.cols);\r\n\r\n      this.render();\r\n    } else {\r\n      this.displayStatusMessage(\"Multistat only supports Table datasets\");\r\n      this.data = data;\r\n      this.rows = null;\r\n      this.render();\r\n    }\r\n  }\r\n\r\n  randomColor() {\r\n    var letters = '456789ABCDE'.split('');\r\n    var color = '#';\r\n    for (var i = 0; i < 6; i++) {\r\n      color += letters[Math.floor(Math.random() * letters.length)];\r\n    }\r\n    return color;\r\n  }\r\n\r\n  getContrastingColor(hexcolor) {\r\n    let match = /^rgba?\\((\\d+),\\s*(\\d+),\\s*(\\d+)(?:,\\s*(\\d+(?:\\.\\d+)?))?\\)$/i.exec(hexcolor);\r\n    if (match) {\r\n      let r = parseInt(match[1]);\r\n      let g = parseInt(match[2]);\r\n      let b = parseInt(match[3]);\r\n\r\n      let brightness = (0.2126 * r + 0.7152 * g + 0.0722 * b);\r\n      let contrastingColor = brightness < 128 ? '#ffffff' : '#000000';\r\n      return contrastingColor;\r\n    }\r\n\r\n    match = /^#?([a-f\\d]{2})([a-f\\d]{2})([a-f\\d]{2})$/i.exec(hexcolor);\r\n    if (match) {\r\n      let r1 = parseInt(match[1], 16);\r\n      let g1 = parseInt(match[2], 16);\r\n      let b1 = parseInt(match[3], 16);\r\n\r\n      let brightness = (0.2126 * r1 + 0.7152 * g1 + 0.0722 * b1);\r\n      let contrastingColor = brightness < 128 ? '#ffffff' : '#000000';\r\n      return contrastingColor;\r\n    }\r\n\r\n    return this.panel.ValueColor;\r\n  }\r\n\r\n  onValueAdd() {\r\n    this.ctrl.panel.Values.push({\r\n      Name: '',\r\n      HighBarColor: this.randomColor(),\r\n      LowBarColor: this.randomColor(),\r\n      Selected: true\r\n    });\r\n    this.ctrl.render();\r\n  }\r\n\r\n  onReorderValues(index, up) {\r\n    const Values = this.ctrl.panel.Values;\r\n    if (up) {\r\n      if (index) Values[index] = Values.splice(index - 1, 1, Values[index])[0];\r\n    } else {\r\n      if (index + 1 < Values.length)\r\n        Values[index] = Values.splice(index + 1, 1, Values[index])[0];\r\n    }\r\n\r\n    this.render();\r\n  }\r\n\r\n  onReorderRecolorRules(index, up) {\r\n    const RecolorRules = this.ctrl.panel.RecolorRules;\r\n    if (up) {\r\n      if (index)\r\n        RecolorRules[index] = RecolorRules.splice(\r\n          index - 1,\r\n          1,\r\n          RecolorRules[index]\r\n        )[0];\r\n    } else {\r\n      if (index + 1 < RecolorRules.length)\r\n        RecolorRules[index] = RecolorRules.splice(\r\n          index + 1,\r\n          1,\r\n          RecolorRules[index]\r\n        )[0];\r\n    }\r\n\r\n    this.render();\r\n  }\r\n\r\n\r\n  onReorderGroupRenamingRules(index, up) {\r\n    const GroupRenamingRules = this.ctrl.panel.GroupRenamingRules;\r\n    if (up) {\r\n      if (index)\r\n        GroupRenamingRules[index] = GroupRenamingRules.splice(\r\n          index - 1,\r\n          1,\r\n          GroupRenamingRules[index]\r\n        )[0];\r\n    } else {\r\n      if (index + 1 < GroupRenamingRules.length)\r\n        GroupRenamingRules[index] = GroupRenamingRules.splice(\r\n          index + 1,\r\n          1,\r\n          GroupRenamingRules[index]\r\n        )[0];\r\n    }\r\n\r\n    this.render();\r\n  }\r\n\r\n\r\n  onReorderLabelRenamingRules(index, up) {\r\n    const LabelRenamingRules = this.ctrl.panel.GroupRenamingRules;\r\n    if (up) {\r\n      if (index)\r\n        GroupRenamingRules[index] = GroupRenamingRules.splice(\r\n          index - 1,\r\n          1,\r\n          GroupRenamingRules[index]\r\n        )[0];\r\n    } else {\r\n      if (index + 1 < GroupRenamingRules.length)\r\n        GroupRenamingRules[index] = GroupRenamingRules.splice(\r\n          index + 1,\r\n          1,\r\n          GroupRenamingRules[index]\r\n        )[0];\r\n    }\r\n\r\n    this.render();\r\n  }\r\n\r\n  onReorderLinks(index, up) {\r\n    const Links = this.ctrl.panel.Links;\r\n    if (up) {\r\n      if (index) Links[index] = Links.splice(index - 1, 1, Links[index])[0];\r\n    } else {\r\n      if (index + 1 < Links.length)\r\n        Links[index] = Links.splice(index + 1, 1, Links[index])[0];\r\n    }\r\n\r\n    this.render();\r\n  }\r\n\r\n  buildDateHtml(dateTimeCol) {\r\n    var $title = this.elem.closest(\".panel-container\").find(\".panel-title\");\r\n    var $maxDate = $title.find(\"span.michaeldmoore-multistat-panel-maxDate\");\r\n\r\n    if ($maxDate.length == 0)\r\n      $maxDate = $title\r\n        .append('<span class=\"michaeldmoore-multistat-panel-maxDate\"/>')\r\n        .children()\r\n        .last();\r\n\r\n    if (dateTimeCol != -1 && this.panel.ShowDate) {\r\n      var maxDate = this.rows[0][dateTimeCol];\r\n\r\n      for (let i = 1; i < this.rows.length; i++) {\r\n        if (maxDate < this.rows[i][dateTimeCol])\r\n          maxDate = this.rows[i][dateTimeCol];\r\n      }\r\n\r\n      var dd = moment(maxDate).add(this.panel.TZOffsetHours, \"h\");\r\n\r\n      if (this.panel.DateFormat.toUpperCase() == \"ELAPSED\")\r\n        $maxDate.text(dd.fromNow()).show();\r\n      else $maxDate.text(dd.format(this.panel.DateFormat)).show();\r\n    } else $maxDate.hide();\r\n  }\r\n\r\n  displayStatusMessage(msg) {\r\n    this.elem.html(\r\n      \"<div class='michaeldmoore-multistat-panel-statusmessage'>\" +\r\n      msg +\r\n      \"</div>\"\r\n    );\r\n  }\r\n\r\n  processRenamingRules(rules, name) {\r\n    let newName = name;\r\n    rules.forEach((rule) => {\r\n      if (rule.enabled) {\r\n        let regex = new RegExp(rule.from, \"ig\");\r\n        newName = newName.replaceAll(regex, rule.to);\r\n      }\r\n    });\r\n    return newName;\r\n  }\r\n\r\n  onRender() {\r\n    if (this.data != null && this.data.rows && this.data.rows.length) {\r\n      var cols = this.cols;\r\n      var dateTimeCol = -1;\r\n      var labelCol = -1;\r\n      var sortCol = 0;\r\n      var groupCol = -1;\r\n      var recolorCol = -1;\r\n\r\n      // clone dashboard variables array\r\n      var dashboardVariables = [...this.dashboardVariables];\r\n      let range = this.timeSrv.timeRangeForUrl();\r\n      dashboardVariables.push({ name: \"from\", value: range.from });\r\n      dashboardVariables.push({ name: \"to\", value: range.to });\r\n\r\n      cols.forEach((colName, i) => {\r\n        if (colName == this.panel.DateTimeColName) dateTimeCol = i;\r\n        if (colName == this.panel.LabelColName) labelCol = i;\r\n        if (colName == this.panel.SortColName) sortCol = i;\r\n        if (colName == this.panel.GroupColName) groupCol = i;\r\n        if (colName == this.panel.RecolorColName) recolorCol = i;\r\n\r\n        this.panel.Values.forEach((Value) => {\r\n          if (colName == Value.Name) {\r\n            Value.Col = i;\r\n          }\r\n        });\r\n      });\r\n\r\n      var SelectedValues = this.panel.Values.filter(\r\n        (value) => value.Col >= 0 && value.Selected\r\n      );\r\n\r\n      //console.log('onRender: this.data.rows\\n'+JSON.stringify(this.data.rows));\r\n\r\n      // process renaming rules (if any) on all group and label column data\r\n      let renamedRows = this.data.rows;\r\n      if ((dateTimeCol != -1 && this.panel.DateFormat.length) ||\r\n        this.panel.LabelRenamingRules.length ||\r\n        (groupCol != -1 && this.panel.GroupRenamingRules.length)) {\r\n        renamedRows = this.data.rows.map((row) => {\r\n          let renamedRow = [...row];\r\n\r\n          if (dateTimeCol != -1 && this.panel.DateFormat.length) {\r\n            let parsedDateTime = moment(renamedRow[dateTimeCol]);\r\n\r\n            if (!parsedDateTime._isValid) {\r\n              let timeStamp = Number(renamedRow[dateTimeCol]);\r\n\r\n              if (timeStamp <= 4102444800) // 2100-01-01 in seconds\r\n                parsedDateTime = moment.unix(timeStamp).utc(); // try parsing timestamp as unix timestamp (in seconds)\r\n              else\r\n                parsedDateTime = moment(timeStamp).utc();  // try parsing timestamp as unix timestamp (in milli-seconds)\r\n            }\r\n\r\n            renamedRow[dateTimeCol] = parsedDateTime.add(this.panel.TZOffsetHours, \"h\").format(this.panel.DateFormat);\r\n          }\r\n\r\n          renamedRow[labelCol] = this.processRenamingRules(this.panel.LabelRenamingRules, renamedRow[labelCol]);\r\n\r\n          if (groupCol != -1)\r\n            renamedRow[groupCol] = this.processRenamingRules(this.panel.GroupRenamingRules, renamedRow[groupCol]);\r\n          return renamedRow;\r\n        });\r\n      }\r\n\r\n      const groupedLabelFunc = function (obj) {\r\n        if (groupCol != -1) return obj[groupCol] + \":\" + obj[labelCol];\r\n        else return obj[labelCol];\r\n      };\r\n\r\n      if (this.panel.LabelNameFilter.length > 0 && labelCol != -1) {\r\n        var regex = new RegExp(this.panel.LabelNameFilter, \"\");\r\n        //this.matchingRows = [];\r\n        this.rows = [];\r\n        for (let i = 0; i < renamedRows.length; i++) {\r\n          let dd = renamedRows[i];\r\n          let label = dd[labelCol];\r\n          if (label.match(regex) != null)\r\n            //this.matchingRows.push(dd);\r\n            this.rows.push(dd);\r\n        }\r\n\r\n        //if (this.matchingRows.length == 0) {\r\n        if (this.rows.length == 0) {\r\n          this.displayStatusMessage(\r\n            \"No data.  Regex filter '\" +\r\n            this.panel.LabelNameFilter +\r\n            \"' eliminated all \" +\r\n            renamedRows.length +\r\n            \" rows from current query\"\r\n          );\r\n          return;\r\n        }\r\n      } else {\r\n        //this.matchingRows = renamedRows;\r\n        this.rows = renamedRows;\r\n      }\r\n      /*\r\n            if (\r\n              this.panel.Aggregate != \"all\" &&\r\n              labelCol != -1 &&\r\n              SelectedValues.length > 0\r\n            ) {\r\n              var oo = [];\r\n              this.rows = [];\r\n              switch (this.panel.Aggregate) {\r\n                case \"first\":\r\n                  this.rows = d3\r\n                    .nest()\r\n                    .key(groupedLabelFunc)\r\n                    .rollup(function (d) {\r\n                      return d[0];\r\n                    })\r\n                    .entries(this.matchingRows)\r\n                    .forEach(function (x) {\r\n                      oo.push(x.value);\r\n                    });\r\n                  this.rows = oo;\r\n                  break;\r\n      \r\n                case \"last\":\r\n                  this.rows = d3\r\n                    .nest()\r\n                    .key(groupedLabelFunc)\r\n                    .rollup(function (d) {\r\n                      return d[d.length - 1];\r\n                    })\r\n                    .entries(this.matchingRows)\r\n                    .forEach(function (x) {\r\n                      oo.push(x.value);\r\n                    });\r\n                  this.rows = oo;\r\n                  break;\r\n      \r\n                case \"sum\":\r\n                  this.rows = d3\r\n                    .nest()\r\n                    .key(groupedLabelFunc)\r\n                    .rollup(function (d) {\r\n                      var dd = Object.values(Object.assign({}, d[d.length - 1]));\r\n                      SelectedValues.forEach((value) => {\r\n                        dd[value.Col] = d3.sum(d, function (d) {\r\n                          return d[value.Col];\r\n                        });\r\n                      });\r\n                      return dd;\r\n                    })\r\n                    .entries(this.matchingRows)\r\n                    .forEach(function (x) {\r\n                      oo.push(x.value);\r\n                    });\r\n                  this.rows = Array.from(oo);\r\n                  break;\r\n      \r\n                case \"mean\":\r\n                  this.rows = d3\r\n                    .nest()\r\n                    .key(groupedLabelFunc)\r\n                    .rollup(function (d) {\r\n                      var dd = Object.values(Object.assign({}, d[d.length - 1]));\r\n                      SelectedValues.forEach((value) => {\r\n                        dd[value.Col] = d3.mean(d, function (d) {\r\n                          return d[value.Col];\r\n                        });\r\n                      });\r\n                      return dd;\r\n                    })\r\n                    .entries(this.matchingRows)\r\n                    .forEach(function (x) {\r\n                      oo.push(x.value);\r\n                    });\r\n                  this.rows = Array.from(oo);\r\n                  break;\r\n      \r\n                  case \"mean\":\r\n                    this.rows = d3\r\n                      .nest()\r\n                      .key(groupedLabelFunc)\r\n                      .rollup(function (d) {\r\n                        var dd = Object.values(Object.assign({}, d[d.length - 1]));\r\n                        dd[valueCol] = d3.mean(d, function (d) {\r\n                          return d[valueCol];\r\n                        });\r\n                        return dd;\r\n                      })\r\n                      .entries(this.matchingRows)\r\n                      .forEach(function (x) {\r\n                        oo.push(x.value);\r\n                      });\r\n                    this.rows = Array.from(oo);\r\n                    break;\r\n        \r\n                  case \"max\":\r\n                  this.rows = d3\r\n                    .nest()\r\n                    .key(groupedLabelFunc)\r\n                    .rollup(function (d) {\r\n                      var dd = Object.values(Object.assign({}, d[d.length - 1]));\r\n                      SelectedValues.forEach((value) => {\r\n                        dd[value.Col] = d3.max(d, function (d) {\r\n                          return d[value.Col];\r\n                        });\r\n                      });\r\n                      return dd;\r\n                    })\r\n                    .entries(this.matchingRows)\r\n                    .forEach(function (x) {\r\n                      oo.push(x.value);\r\n                    });\r\n                  this.rows = Array.from(oo);\r\n                  break;\r\n      \r\n                case \"min\":\r\n                  this.rows = d3\r\n                    .nest()\r\n                    .key(groupedLabelFunc)\r\n                    .rollup(function (d) {\r\n                      var dd = Object.values(Object.assign({}, d[d.length - 1]));\r\n                      SelectedValues.forEach((value) => {\r\n                        dd[value.Col] = d3.min(d, function (d) {\r\n                          return d[value.Col];\r\n                        });\r\n                      });\r\n                      return dd;\r\n                    })\r\n                    .entries(this.matchingRows)\r\n                    .forEach(function (x) {\r\n                      oo.push(x.value);\r\n                    });\r\n                  this.rows = Array.from(oo);\r\n                  break;\r\n              }\r\n            } else {\r\n              this.rows = this.matchingRows;\r\n            }\r\n            //console.log('after aggregation('+this.panel.Aggregate+') this.rows:\\n'+JSON.stringify(this.rows));\r\n      */\r\n\r\n      var groupNameOffset = this.panel.ShowGroupLabels\r\n        ? Number(this.panel.GroupLabelFontSize.replace(\"%\", \"\")) * 0.15\r\n        : 0;\r\n\r\n      if (groupCol >= 0) {\r\n        this.groupedRows = Array.from(d3\r\n          .group(this.rows, d => d[groupCol]));\r\n\r\n        if (this.panel.GroupNameFilter.length > 0) {\r\n          var regexGroupRows = new RegExp(this.panel.GroupNameFilter, \"\");\r\n          let matchingGroups = [];\r\n          for (let i = 0; i < this.groupedRows.length; i++) {\r\n            let groupName = this.groupedRows[i][0];\r\n            if (groupName.match(regexGroupRows) != null)\r\n              matchingGroups.push(this.groupedRows[i]);\r\n          }\r\n\r\n          if (matchingGroups.length > 0) this.groupedRows = matchingGroups;\r\n          else {\r\n            this.displayStatusMessage(\r\n              \"No groups.  Group Regex filter '\" +\r\n              this.panel.GroupNameFilter +\r\n              \"' eliminated all \" +\r\n              this.groupedRows.length +\r\n              \" groups from current query\"\r\n            );\r\n            return;\r\n          }\r\n        }\r\n\r\n        let groupSortString = this.panel.GroupSortString;\r\n\r\n        this.groupedRows.sort(function (a, b) {\r\n          var aPos = groupSortString.search(a[0]);\r\n          var bPos = groupSortString.search(b[0]);\r\n\r\n          if (aPos == bPos) return a[0].localeCompare(b[0]);\r\n          else if (aPos == -1) return 1;\r\n          else if (bPos == -1) return -1;\r\n          else return aPos - bPos;\r\n        });\r\n      } else {\r\n        this.groupedRows = null;\r\n      }\r\n\r\n      // In edit mode with grafana > vesion 7, the svg element is hidden, not removed.\r\n      // this kludge revoves it, if it already exists so we don't end up adding svg content to the wrong (hidden) element.\r\n      //d3.select(\".\" + this.className).remove();\r\n      let x$ = d3.select(\".\" + this.className);\r\n      x$.remove();\r\n\r\n      this.elem.html(\r\n        \"<div class='\" +\r\n        this.className +\r\n        \"' style='display: flex; flex-direction: column; height:100%; width:100%'>\" +\r\n        \"</div>\"\r\n      );\r\n\r\n      var $container = this.elem.find(\"div\");\r\n\r\n      // Now add, or re-add, the svg element and content\r\n      this.svg = d3\r\n        .select(\".\" + this.className)\r\n        .append(\"svg\")\r\n        .attr(\"height\", \"100%\");\r\n\r\n      if (this.panel.Legend) {\r\n        var $legend = $container\r\n          .append(\r\n            \"<div><p></p><ul class='michaeldmoore-multistat-panel-legend'></ul></div>\"\r\n          )\r\n          .find(\"ul\");\r\n\r\n        const legendValues = this.panel.Values.filter(\r\n          (value) => value.Col >= 0\r\n        );\r\n        legendValues.forEach((value, i) => {\r\n          ///////////////////////////////////////////////////////////////////////////////\r\n          // Be careful with this - the toggling/selection logic is quite complicated. //\r\n          ///////////////////////////////////////////////////////////////////////////////\r\n          let deselectedClassName = value.Selected\r\n            ? \"\"\r\n            : \" class='michaeldmoore-multistat-panel-legend-deselected'\";\r\n          $legend\r\n            .append(\"<li\" + deselectedClassName + \">\" + value.Name + \"</li>\")\r\n            .children()\r\n            .last()\r\n            .css(\"background-color\", value.HighBarColor)\r\n            .css(\"color\", this.getContrastingColor(value.HighBarColor))\r\n            .click(function () {\r\n              //console.log('legend-click() value='+JSON.stringify(value,null,2));\r\n              if (window.event.ctrlKey) {\r\n                // toggle this item only\r\n                value.Selected = !value.Selected;\r\n              } else {\r\n                if (!value.Selected || SelectedValues.length != 1) {\r\n                  // deselect everything\r\n                  legendValues.forEach((v) => (v.Selected = false));\r\n                  // and re-select this one;\r\n                  value.Selected = true;\r\n                } else {\r\n                  legendValues.forEach((v) => (v.Selected = true));\r\n                }\r\n              }\r\n              //console.log('legend-click() legendValues='+JSON.stringify(legendValues,null,2));\r\n              // force a re-render\r\n              CTRL.$scope.$apply(() => {\r\n                CTRL.render();\r\n              });\r\n            });\r\n        });\r\n      }\r\n\r\n      var h = $container.find(\"svg\").height();\r\n      var w = $container.width() - 15;\r\n\r\n      this.buildDateHtml(dateTimeCol);\r\n\r\n      var labelMargin =\r\n        isNumber(this.panel.LabelMargin) && this.panel.LabelMargin >= 0\r\n          ? this.panel.LabelMargin\r\n          : null;\r\n      var lowSideMargin =\r\n        this.panel.LowSideMargin >= 0 ? this.panel.LowSideMargin : 0;\r\n      var highSideMargin =\r\n        this.panel.HighSideMargin >= 0 ? this.panel.HighSideMargin : 0;\r\n\r\n      this.svg\r\n        .selectAll(\"rect.michaeldmoore-multistat-panel-bar.highflash\")\r\n        .interrupt();\r\n\r\n      this.svg\r\n        .selectAll(\"rect.michaeldmoore-multistat-panel-bar.lowflash\")\r\n        .interrupt();\r\n\r\n      var id = this.panel.id;\r\n      var barPadding = this.panel.BarPadding;\r\n      var multiBarPadding = this.panel.MultiBarPadding;\r\n      var baseLineValue = this.panel.BaseLineValue;\r\n      var minLineValue = this.panel.MinLineValue;\r\n      var maxLineValue = this.panel.MaxLineValue;\r\n      var highLimitValue = this.panel.HighLimitValue;\r\n      var HighLimitBarColor = this.panel.HighLimitBarColor;\r\n      var HighLimitBarFlashColor = this.panel.HighLimitBarFlashColor;\r\n      var HighLimitBarFlashTimeout = this.panel.HighLimitBarFlashTimeout;\r\n      var recolorHighLimitBar = this.panel.RecolorHighLimitBar;\r\n      var Links = this.panel.Links;\r\n      var lowLimitValue = this.panel.LowLimitValue;\r\n      var LowLimitBarColor = this.panel.LowLimitBarColor;\r\n      var LowLimitBarFlashColor = this.panel.LowLimitBarFlashColor;\r\n      var LowLimitBarFlashTimeout = this.panel.LowLimitBarFlashTimeout;\r\n      var RecolorRules = this.panel.RecolorRules;\r\n      var recolorLowLimitBar = this.panel.RecolorLowLimitBar;\r\n      var flashHighLimitBar = this.panel.FlashHighLimitBar;\r\n      var flashLowLimitBar = this.panel.FlashLowLimitBar;\r\n      var tooltipType = this.panel.ToolTipType;\r\n      var tooltipFontSize = this.panel.ToolTipFontSize;\r\n      var DateTimeColName = this.panel.DateTimeColName;\r\n      var TooltipDateFormat = this.panel.TooltipDateFormat;\r\n      var ValueColName = this.panel.ValueColName;\r\n      var ValueDecimals = this.panel.ValueDecimals;\r\n      var OddRowColor = this.panel.OddRowColor;\r\n      var EvenRowColor = this.panel.EvenRowColor;\r\n      var OutlineColor = this.panel.OutlineColor;\r\n      var TZOffsetHours = this.panel.TZOffsetHours;\r\n      var GroupCols = this.panel.GroupCols;\r\n      var GroupGap = this.panel.GroupGap;\r\n      var VGroupGap = this.panel.VGroupGap;\r\n      var ScaleFactor = Number(this.panel.ScaleFactor);\r\n      var ValuePosition = this.panel.ValuePosition;\r\n\r\n      var panelID = \"michaeldmoore-multistat-panel-\" + id;\r\n      var tooltipDivID = \"michaeldmoore-multistat-panel-tooltip-\" + id;\r\n\r\n      var minValue =\r\n        SelectedValues.length &&\r\n        d3.min(this.rows, function (d) {\r\n          let min = Number(d[SelectedValues[0].Col]);\r\n          for (var i = 1; i < SelectedValues.length; i++) {\r\n            let col = SelectedValues[i].Col;\r\n            let val = Number(d[col]);\r\n            if (min > val) min = val;\r\n          }\r\n          return min * ScaleFactor;\r\n        });\r\n      if (isNumber(minLineValue) == false) minLineValue = minValue;\r\n\r\n      var maxValue =\r\n        SelectedValues.length &&\r\n        d3.max(this.rows, function (d) {\r\n          let max = Number(d[SelectedValues[0].Col]);\r\n          for (var i = 1; i < SelectedValues.length; i++) {\r\n            let col = SelectedValues[i].Col;\r\n            let val = Number(d[col]);\r\n            if (max < val) max = val;\r\n          }\r\n          return max * ScaleFactor;\r\n        });\r\n      if (isNumber(maxLineValue) == false) maxLineValue = maxValue;\r\n\r\n      if (isNumber(baseLineValue) == false) baseLineValue = 0;\r\n\r\n      if (minLineValue > baseLineValue) minLineValue = baseLineValue;\r\n\r\n      if (isNumber(lowLimitValue) && minLineValue > lowLimitValue)\r\n        minLineValue = lowLimitValue;\r\n\r\n      if (maxLineValue < baseLineValue) maxLineValue = baseLineValue;\r\n\r\n      if (isNumber(highLimitValue) && maxLineValue < highLimitValue)\r\n        maxLineValue = highLimitValue;\r\n\r\n      $(\"#\" + tooltipDivID).remove();\r\n\r\n      var sortData = function (data, sortDirection) {\r\n        if (sortDirection != \"none\") {\r\n          var ascending = sortDirection == \"ascending\";\r\n          data.sort(function (x, y) {\r\n            let xx = x[sortCol];\r\n            let yy = y[sortCol];\r\n\r\n            if (isNumber(xx) && isNumber(yy))\r\n              return ascending ? xx - yy : yy - xx;\r\n            else return ascending ? xx.localeCompare(yy) : yy.localeCompare(xx);\r\n          });\r\n        }\r\n      };\r\n\r\n      var aggregateData = function (data, aggregate) {\r\n//        console.log('aggregateData(' + aggregate + ') ' + JSON.stringify(data));\r\n        var rows = [];\r\n        switch (aggregate) {\r\n          case \"first\":\r\n            d3\r\n              .group(data, groupedLabelFunc)\r\n              .forEach(function (x) {\r\n//                console.log(' adding ' + JSON.stringify(x[0]));\r\n                rows.push(x[0]);\r\n              });\r\n            break;\r\n          case \"last\":\r\n            d3\r\n              .group(data, groupedLabelFunc)\r\n              .forEach(function (x) {\r\n//                console.log(' adding ' + JSON.stringify(x[x.length - 1]));\r\n                rows.push(x[x.length - 1]);\r\n              });\r\n            break;\r\n\r\n          case \"sum\":\r\n            d3\r\n              .group(data, groupedLabelFunc)\r\n              .forEach(function (x) {\r\n                var dd = Object.values(Object.assign({}, x[0]));\r\n                SelectedValues.forEach((value) => {\r\n                  dd[value.Col] = d3.sum(x, function (x) {\r\n                    return x[value.Col];\r\n                  });\r\n                });\r\n\r\n//                console.log(' adding ' + JSON.stringify(dd));\r\n                rows.push(dd);\r\n              });\r\n            break;\r\n\r\n\r\n          case \"mean\":\r\n            d3\r\n              .group(data, groupedLabelFunc)\r\n              .forEach(function (x) {\r\n                var dd = Object.values(Object.assign({}, x[0]));\r\n                SelectedValues.forEach((value) => {\r\n                  dd[value.Col] = d3.mean(x, function (x) {\r\n                    return x[value.Col];\r\n                  });\r\n                });\r\n\r\n//                console.log(' adding ' + JSON.stringify(dd));\r\n                rows.push(dd);\r\n              });\r\n            break;\r\n\r\n          case \"max\":\r\n            d3\r\n              .group(data, groupedLabelFunc)\r\n              .forEach(function (x) {\r\n                var dd = Object.values(Object.assign({}, x[0]));\r\n                SelectedValues.forEach((value) => {\r\n                  dd[value.Col] = d3.max(x, function (x) {\r\n                    return x[value.Col];\r\n                  });\r\n                });\r\n\r\n//                console.log(' adding ' + JSON.stringify(dd));\r\n                rows.push(dd);\r\n              });\r\n            break;\r\n\r\n          case \"min\":\r\n            d3\r\n              .group(data, groupedLabelFunc)\r\n              .forEach(function (x) {\r\n                var dd = Object.values(Object.assign({}, x[0]));\r\n                SelectedValues.forEach((value) => {\r\n                  dd[value.Col] = d3.min(x, function (x) {\r\n                    return x[value.Col];\r\n                  });\r\n                });\r\n\r\n//                console.log(' adding ' + JSON.stringify(dd));\r\n                rows.push(dd);\r\n              });\r\n            break;\r\n        }\r\n        return rows;\r\n      };\r\n\r\n      var translateValues = function (s, d) {\r\n        // lookup column index corresponding to the substitution tokens and replace with this bar's value\r\n        let s1 = s;\r\n        const re = /\\{[^}]+\\}/g;\r\n        let g = re.exec(s);\r\n        while (g) {\r\n          //console.log('Translating token '+g);\r\n          for (var i = 0; i < cols.length; i++) {\r\n            if (g == \"{\" + cols[i] + \"}\") {\r\n              s1 = s1.replace(g, d[i]);\r\n              break;\r\n            }\r\n          }\r\n\r\n          // do the same thing with dashboard variables...\r\n          for (var j = 0; j < dashboardVariables.length; j++) {\r\n            let dv = dashboardVariables[j];\r\n            if (g == \"{\" + dv.name + \"}\") {\r\n              //console.log(\"dashboard variable[\" + dv.name + \"]=\" + dv.value);\r\n              s1 = s1.replace(g, dv.value);\r\n              break;\r\n            }\r\n          }\r\n\r\n          g = re.exec(s);\r\n        }\r\n        //console.log('Translating url '+s+' to ' + s1);\r\n        return s1;\r\n      };\r\n\r\n      var getTooltipContent = function (d) {\r\n        let html = \"\";\r\n        if (tooltipType && Array.isArray(d)) {\r\n          html +=\r\n            \"<table style='font-size:\" +\r\n            tooltipFontSize.replace(\"%\", \"\") / 100 +\r\n            \"em'>\";\r\n          if (labelCol != -1)\r\n            html +=\r\n              \"<thead><tr class='michaeldmoore-multistat-panel-tooltip-title'><th colspan='2' align='center'>\" +\r\n              d[labelCol] +\r\n              \"</th></tr></thead>\";\r\n          if (Array.isArray(d)) {\r\n            html += \"<tbody>\";\r\n            for (var i = 0; i < d.length; i++) {\r\n              if (i != labelCol) {\r\n                var cc = cols[i];\r\n                var dd = d[i];\r\n\r\n                if (cc == DateTimeColName)\r\n                  dd = TooltipDateFormat.length ? moment(dd)\r\n                    .format(TooltipDateFormat) : dd;\r\n                else if (cc == ValueColName && isNumber(dd))\r\n                  dd = Number(dd).toFixed(ValueDecimals);\r\n\r\n                html += \"<tr><td>\" + cc + \"</td><td>\" + dd + \"</td></tr>\";\r\n              }\r\n            }\r\n            html += \"</tbody></table>\";\r\n          }\r\n\r\n          if (Links.length) {\r\n            html += \"<table><tbody>\";\r\n            Links.forEach((l) => {\r\n              html +=\r\n                \"<tr><td align='right'><i class='fa fa-link'></i></td><td><a href='\" +\r\n                translateValues(l.url, d) +\r\n                (l.newtab ? \"' target='_blank'\" : \"'\") +\r\n                \">\" +\r\n                translateValues(l.name, d) +\r\n                \"</a></td></tr>\";\r\n            });\r\n            html += \"</tbody></table>\";\r\n          }\r\n        }\r\n\r\n        return html;\r\n      };\r\n\r\n      var isInTooltip = false;\r\n      var $panel;\r\n      var $panelContent;\r\n      var panelContent;\r\n      var tooltipShow = function (d) {\r\n        if ($(\"#\" + tooltipDivID).length == 0) {\r\n          $panel = $(\".\" + panelID);\r\n          $panelContent = $panel.parent().parent().parent().parent();\r\n          panelContent = d3.selectAll($panelContent);\r\n          panelContent\r\n            .append(\"div\")\r\n            .attr(\"id\", tooltipDivID)\r\n            .style(\"opacity\", 0);\r\n        }\r\n\r\n        const tooltipDiv = d3.selectAll(\"#\" + tooltipDivID);\r\n\r\n        let tooltipHtml = getTooltipContent(d);\r\n        if (tooltipHtml.length) {\r\n          tooltipDiv\r\n            .classed(\r\n              \"michaeldmoore-multistat-panel-\" + tooltipType + \"-tooltip\",\r\n              true\r\n            )\r\n            .html(tooltipHtml)\r\n            .on(\"mouseover\", function () {\r\n              if (!isInTooltip) {\r\n                isInTooltip = true;\r\n                tooltipHide(true);\r\n              }\r\n            })\r\n            .on(\"mouseleave\", function () {\r\n              isInTooltip = false;\r\n              tooltipHide(false);\r\n            });\r\n\r\n          const $tooltipDiv = $(\"#\" + tooltipDivID);\r\n          const tooltipWidth = $tooltipDiv.width();\r\n          const tooltipHeight = $tooltipDiv.height();\r\n          const minTop = 28;\r\n\r\n          const mouseCoordinates = d3.mouse(panelContent.node());\r\n          let Left = mouseCoordinates[0] - tooltipWidth / 2;\r\n          let Top = mouseCoordinates[1] + minTop - tooltipHeight / 2;\r\n\r\n          let panelWidth = $panel.width();\r\n          let panelHeight = $panel.height();\r\n\r\n          if (Left < 0) Left = 0;\r\n          else if (Left > panelWidth - tooltipWidth)\r\n            Left = panelWidth - tooltipWidth;\r\n\r\n          if (Top < 0) Top = 0;\r\n          else if (Top > panelHeight + minTop - tooltipHeight)\r\n            Top = panelHeight + minTop - tooltipHeight;\r\n\r\n          tooltipDiv\r\n            .transition()\r\n            .duration(200)\r\n            .style(\"opacity\", 1.0)\r\n            .style(\"left\", Left + \"px\")\r\n            .style(\"top\", Top + \"px\");\r\n        }\r\n      };\r\n\r\n      var tooltipHide = function (cancel) {\r\n        const tooltipDiv = d3.selectAll(\"#\" + tooltipDivID);\r\n\r\n        if (cancel) {\r\n          //console.log(\"cancelling tooltip hide\");\r\n          tooltipDiv.transition().style(\"opacity\", 1.0);\r\n        } else {\r\n          tooltipDiv\r\n            .transition()\r\n            .duration(2000)\r\n            .style(\"opacity\", 0)\r\n            .on(\"end\", function () {\r\n              d3.select(this)\r\n                .html(\"\")\r\n                .classed(\r\n                  \"michaeldmoore-multistat-panel-\" + tooltipType + \"-tooltip\",\r\n                  false\r\n                );\r\n            });\r\n        }\r\n      };\r\n\r\n      var scaleAndClipValue = function (d) {\r\n        var val = d * ScaleFactor;\r\n        if (val > maxLineValue) val = maxLineValue;\r\n        if (val < minLineValue) val = minLineValue;\r\n\r\n        return val;\r\n      };\r\n\r\n      var getBarColor = function (d, valueDef) {\r\n        if (recolorCol != -1) {\r\n          let recolorString = d[recolorCol];\r\n\r\n          if (RecolorRules.length) {\r\n            if (recolorString) {\r\n              let recolorRule = RecolorRules.find((r) => {\r\n                if (r.pattern) {\r\n                  switch (r.matchType) {\r\n                    case \"reg-ex\":\r\n                      let re = RegExp(r.pattern);\r\n                      return re.test(recolorString);\r\n\r\n                    case \"list\":\r\n                      return r.pattern.indexOf(recolorString) != -1;\r\n\r\n                    case \"subset\":\r\n                      return recolorString.indexOf(r.pattern) != -1;\r\n\r\n                    default:\r\n                      return r.pattern === recolorString;\r\n                  }\r\n                }\r\n                return false;\r\n              });\r\n\r\n              if (recolorRule) return recolorRule.color;\r\n            }\r\n          }\r\n\r\n          // no matching rule found, check if recolorString is a valid color\r\n          const s = new Option().style;\r\n          s.color = recolorString;\r\n          if (s.color !== \"\") return recolorString;\r\n        }\r\n\r\n        let value = d[valueDef.Col] * ScaleFactor;\r\n        if (recolorHighLimitBar && value > highLimitValue)\r\n          return HighLimitBarColor;\r\n        if (recolorLowLimitBar && value < lowLimitValue)\r\n          return LowLimitBarColor;\r\n\r\n        // All else fails, let's use the standard colors for this bar...\r\n        return value > baseLineValue\r\n          ? valueDef.HighBarColor\r\n          : valueDef.LowBarColor;\r\n      };\r\n\r\n      var getValueColor = function (d, valueDef) {\r\n        let barColor = getBarColor(d, valueDef);\r\n        let valueColor = CTRL.getContrastingColor(barColor);\r\n        return valueColor;\r\n      };\r\n\r\n      if (this.panel.Horizontal) {\r\n        var plotGroupHorizontal = function (\r\n          panel,\r\n          svg,\r\n          data,\r\n          numRows,\r\n          groupName,\r\n          groupNameOffset,\r\n          left,\r\n          w,\r\n          hh,\r\n          dh\r\n        ) {\r\n          // Draw border rectangle\r\n          /*svg.append(\"rect\")\r\n                    .attr(\"width\", w)\r\n                    .attr(\"height\", dh)\r\n                    .attr(\"x\", left)\r\n                    .attr(\"y\", hh)\r\n                    .attr(\"stroke\", \"yellow\");*/\r\n\r\n          sortData(data, panel.SortDirection);\r\n\r\n          if (\r\n            panel.Aggregate != \"all\" &&\r\n            labelCol != -1 &&\r\n            SelectedValues.length > 0\r\n          ) {\r\n            //            console.log('data(in) = ' +JSON.stringify(data));\r\n            data = aggregateData(data, panel.Aggregate);\r\n          }\r\n//          console.log('data = ' + JSON.stringify(data));\r\n\r\n          // Add Above-High Side Group Names\r\n          if (groupName != \"\" && panel.ShowGroupLabels) {\r\n            svg\r\n              .append(\"text\")\r\n              .text(groupName)\r\n              .attr(\"x\", left + (labelMargin + w) / 2)\r\n              .attr(\"y\", hh + groupNameOffset / 2)\r\n              .attr(\"font-family\", \"sans-serif\")\r\n              .attr(\"font-size\", panel.GroupLabelFontSize)\r\n              .attr(\"fill\", panel.GroupLabelColor)\r\n              .attr(\"background\", \"blue\")\r\n              .attr(\"text-anchor\", \"middle\")\r\n              .attr(\"dominant-baseline\", \"central\");\r\n          }\r\n\r\n          hh += groupNameOffset;\r\n          dh -= groupNameOffset;\r\n\r\n          // Draw border rectangle\r\n          /*svg.append(\"rect\")\r\n                    .attr(\"width\", w)\r\n                    .attr(\"height\", dh)\r\n                    .attr(\"x\", left)\r\n                    .attr(\"y\", hh)\r\n                    .attr(\"stroke\", \"#ffffff\");*/\r\n\r\n          var labels = data.map(function (d) {\r\n            return d[labelCol];\r\n          });\r\n          while (labels.length < numRows)\r\n            labels = labels.concat(\r\n              \"_\" + Math.random().toString(36).substr(2, 9)\r\n            );\r\n\r\n          var labelScale = d3\r\n            .scaleBand()\r\n            .domain(labels)\r\n            .rangeRound([hh + highSideMargin, hh + dh - lowSideMargin])\r\n            .paddingInner(barPadding / 100)\r\n            .paddingOuter(barPadding / 200);\r\n\r\n          var stripedata = data.concat(d3.range(data.length, numRows));\r\n\r\n          var stripeScale = d3\r\n            .scaleBand()\r\n            .domain(stripedata)\r\n            .rangeRound([hh + highSideMargin, hh + dh - lowSideMargin]);\r\n\r\n          // Draw background of alternating stripes\r\n          var oddeven = false;\r\n          svg\r\n            .append(\"g\")\r\n            .selectAll(\"rect\")\r\n            .data(stripedata)\r\n            .enter()\r\n            .append(\"rect\")\r\n            .attr(\"class\", \"michaeldmoore-multistat-panel-row\")\r\n            .attr(\"width\", w)\r\n            .attr(\"height\", stripeScale.step())\r\n            .attr(\"x\", left)\r\n            .attr(\"y\", function (d) {\r\n              return stripeScale(d);\r\n            })\r\n            .attr(\"fill\", function (d) {\r\n              oddeven = !oddeven;\r\n              return oddeven ? OddRowColor : EvenRowColor;\r\n            });\r\n\r\n          var g1 = svg\r\n            .append(\"g\")\r\n            .selectAll(\"text\")\r\n            .data(data)\r\n            .enter()\r\n            .append(\"g\");\r\n\r\n          if (panel.ShowValues && panel.ValuePosition == \"top\") {\r\n            var maxValueWidth = 0;\r\n            SelectedValues.forEach((valueDef, index) => {\r\n              let valueCol = valueDef.Col;\r\n              if (valueCol >= 0) {\r\n                let gap =\r\n                  SelectedValues.length > 1\r\n                    ? (labelScale.bandwidth() * multiBarPadding) /\r\n                    (SelectedValues.length - 1) /\r\n                    100\r\n                    : 0;\r\n                let height =\r\n                  (labelScale.bandwidth() - gap * (SelectedValues.length - 1)) /\r\n                  SelectedValues.length;\r\n\r\n                g1.append(\"text\")\r\n                  .text(function (d) {\r\n                    return (Number(d[valueCol]) * ScaleFactor).toFixed(\r\n                      ValueDecimals\r\n                    );\r\n                  })\r\n                  .attr(\"x\", left + w)\r\n                  .attr(\"y\", function (d, i) {\r\n                    return (\r\n                      labelScale(d[labelCol]) +\r\n                      height / 2 +\r\n                      (height + gap) * index\r\n                    );\r\n                  })\r\n                  .attr(\"font-family\", \"sans-serif\")\r\n                  .attr(\"font-size\", panel.ValueFontSize)\r\n                  .attr(\"fill\", panel.ValueColor)\r\n                  .attr(\"text-anchor\", \"end\")\r\n                  .attr(\"dominant-baseline\", \"central\")\r\n                  .each(function (d, i) {\r\n                    var thisWidth = this.getComputedTextLength();\r\n                    maxValueWidth = d3.max([maxValueWidth, thisWidth]);\r\n                  });\r\n              }\r\n            });\r\n\r\n            w -= maxValueWidth;\r\n          }\r\n\r\n          if (panel.ShowLabels) {\r\n            var maxLabelWidth = 0;\r\n            var labelAngle = Number(panel.LableAngle);\r\n            g1.append(\"text\")\r\n              .text(function (d) {\r\n                return d[labelCol];\r\n              })\r\n              .attr(\"font-family\", \"sans-serif\")\r\n              .attr(\"font-size\", panel.LabelFontSize)\r\n              .attr(\"fill\", function (d, i) {\r\n                if (SelectedValues.length) {\r\n                  let minvalue = d[SelectedValues[0].Col] * ScaleFactor;\r\n                  let maxvalue = minvalue;\r\n                  SelectedValues.forEach((v) => {\r\n                    let value = d[v.Col] * ScaleFactor;\r\n                    if (minvalue > value) minvalue = value;\r\n                    if (maxvalue < value) maxvalue = value;\r\n                  });\r\n\r\n                  if (maxvalue > maxLineValue || minvalue < minLineValue)\r\n                    return panel.OutOfRangeLabelColor;\r\n                }\r\n                return panel.LabelColor;\r\n              })\r\n              .attr(\"text-anchor\", \"middle\")\r\n              .attr(\"dominant-baseline\", \"central\")\r\n              .attr(\"transform\", function (d, i) {\r\n                var bbox = this.getBBox();\r\n                var s = Math.sin((labelAngle * Math.PI) / 180);\r\n                var c = Math.cos((labelAngle * Math.PI) / 180);\r\n                var b = Math.abs(bbox.width * s) + Math.abs(bbox.height * c);\r\n                var a = Math.abs(bbox.width * c) + Math.abs(bbox.height * s);\r\n\r\n                var y = labelScale(d[labelCol]) + labelScale.bandwidth() / 2;\r\n                var x = left + a / 2;\r\n                return (\r\n                  \"translate(\" + x + \",\" + y + \") rotate(\" + labelAngle + \")\"\r\n                );\r\n              })\r\n              .each(function (d, i) {\r\n                var bbox = this.getBBox();\r\n                var s = Math.sin((labelAngle * Math.PI) / 180);\r\n                var c = Math.cos((labelAngle * Math.PI) / 180);\r\n                var b = Math.abs(bbox.width * s) + Math.abs(bbox.height * c);\r\n                var a = Math.abs(bbox.width * c) + Math.abs(bbox.height * s);\r\n\r\n                var thisWidth = a;\r\n                maxLabelWidth = d3.max([maxLabelWidth, thisWidth]);\r\n              });\r\n\r\n            if (isNumber(labelMargin)) {\r\n              left += labelMargin;\r\n              w -= labelMargin;\r\n            } else {\r\n              left += maxLabelWidth;\r\n              w -= maxLabelWidth;\r\n            }\r\n          }\r\n\r\n          var valueScale = d3\r\n            .scaleLinear()\r\n            .domain([minLineValue, maxLineValue])\r\n            .range([left + labelMargin, left + w])\r\n            .nice();\r\n\r\n          function vLine(svg, value, color, strokeWidth) {\r\n            svg\r\n              .append(\"line\")\r\n              .style(\"stroke\", color)\r\n              .attr(\"stroke-width\", strokeWidth == null ? 1 : strokeWidth)\r\n              .attr(\"y1\", hh + highSideMargin)\r\n              .attr(\"x1\", valueScale(value))\r\n              .attr(\"y2\", hh + dh - lowSideMargin)\r\n              .attr(\"x2\", valueScale(value));\r\n          }\r\n\r\n          if (panel.ShowBaseLine)\r\n            vLine(svg, baseLineValue, panel.BaseLineColor, panel.BaseLineWidth);\r\n\r\n          if (panel.ShowMaxLine)\r\n            vLine(svg, maxLineValue, panel.MaxLineColor, panel.MaxLineWidth);\r\n\r\n          if (panel.ShowMinLine)\r\n            vLine(svg, minLineValue, panel.MinLineColor, panel.MinLineWidth);\r\n\r\n          if (panel.ShowHighLimitLine)\r\n            vLine(\r\n              svg,\r\n              highLimitValue,\r\n              panel.HighLimitLineColor,\r\n              panel.HighLimitLineWidth\r\n            );\r\n\r\n          if (panel.ShowLowLimitLine)\r\n            vLine(\r\n              svg,\r\n              lowLimitValue,\r\n              panel.LowLimitLineColor,\r\n              panel.LowLimitLineWidth\r\n            );\r\n\r\n          if (panel.ShowBars) {\r\n            SelectedValues.forEach((valueDef, index) => {\r\n              let valueCol = valueDef.Col;\r\n              if (valueCol >= 0) {\r\n                let gap =\r\n                  SelectedValues.length > 1\r\n                    ? (labelScale.bandwidth() * multiBarPadding) /\r\n                    (SelectedValues.length - 1) /\r\n                    100\r\n                    : 0;\r\n                let height =\r\n                  (labelScale.bandwidth() - gap * (SelectedValues.length - 1)) /\r\n                  SelectedValues.length;\r\n\r\n                g1.append(\"rect\")\r\n                  .attr(\"class\", \"michaeldmoore-multistat-panel-bar\")\r\n                  .attr(\"width\", function (d) {\r\n                    var val = scaleAndClipValue(d[valueCol]);\r\n                    return Math.abs(\r\n                      valueScale(val) - valueScale(baseLineValue)\r\n                    );\r\n                  })\r\n                  .attr(\"height\", height)\r\n                  .attr(\"x\", function (d) {\r\n                    var val = scaleAndClipValue(d[valueCol]);\r\n                    return d3.min([valueScale(val), valueScale(baseLineValue)]);\r\n                  })\r\n                  .attr(\"y\", function (d, i) {\r\n                    return labelScale(d[labelCol]) + (height + gap) * index;\r\n                  })\r\n                  .attr(\"fill\", function (d) {\r\n                    return getBarColor(d, valueDef);\r\n                  })\r\n                  .classed(\"highflash\", function (d) {\r\n                    return (\r\n                      recolorHighLimitBar &&\r\n                      flashHighLimitBar &&\r\n                      d[valueCol] * ScaleFactor > highLimitValue\r\n                    );\r\n                  })\r\n                  .classed(\"lowflash\", function (d) {\r\n                    return (\r\n                      recolorLowLimitBar &&\r\n                      flashLowLimitBar &&\r\n                      d[valueCol] * ScaleFactor < lowLimitValue\r\n                    );\r\n                  });\r\n              }\r\n            });\r\n          }\r\n\r\n          if (panel.ShowLines) {\r\n            var bw = labelScale.step();\r\n\r\n            if (panel.LineWidth) {\r\n              var curveFunc = d3.curveLinear;\r\n              switch (panel.CurveType) {\r\n                case \"Linear\":\r\n                  curveFunc = d3.curveLinear;\r\n                  break;\r\n                case \"Monotone\":\r\n                  curveFunc = d3.curveMonotoneY;\r\n                  break;\r\n                case \"Cardinal\":\r\n                  curveFunc = d3.curveCardinal;\r\n                  break;\r\n                case \"Catmull-Rom\":\r\n                  curveFunc = d3.curveCatmullRom;\r\n                  break;\r\n              }\r\n\r\n              var lineFunction = d3\r\n                .line()\r\n                .curve(curveFunc)\r\n                .x(function (d) {\r\n                  return d.x;\r\n                })\r\n                .y(function (d) {\r\n                  return d.y;\r\n                });\r\n\r\n              SelectedValues.forEach((value, index) => {\r\n                let gap =\r\n                  SelectedValues.length > 1\r\n                    ? (labelScale.bandwidth() * multiBarPadding) /\r\n                    (SelectedValues.length - 1) /\r\n                    100\r\n                    : 0;\r\n                let width =\r\n                  (labelScale.bandwidth() - gap * (SelectedValues.length - 1)) /\r\n                  SelectedValues.length;\r\n\r\n                if (panel.LineWidth) {\r\n                  var points = [];\r\n                  for (var i = 0; i < data.length; i++) {\r\n                    var d = data[i];\r\n                    var y =\r\n                      labelScale(d[labelCol]) +\r\n                      width / 2 +\r\n                      (width + gap) * index;\r\n                    var x = valueScale(d[value.Col] * ScaleFactor);\r\n                    points.push({\r\n                      x,\r\n                      y,\r\n                    });\r\n                  }\r\n\r\n                  svg\r\n                    .append(\"path\")\r\n                    .attr(\"d\", lineFunction(points))\r\n                    .attr(\"stroke\", panel.LineColor)\r\n                    .attr(\"stroke-width\", panel.LineWidth)\r\n                    .attr(\"fill\", \"none\");\r\n                }\r\n\r\n                if (panel.DotSize) {\r\n                  g1.append(\"circle\")\r\n                    .attr(\"r\", panel.DotSize / 2.0)\r\n                    .attr(\"fill\", panel.DotColor)\r\n                    .attr(\"cy\", function (d) {\r\n                      return (\r\n                        labelScale(d[labelCol]) +\r\n                        width / 2 +\r\n                        (width + gap) * index\r\n                      );\r\n                    })\r\n                    .attr(\"cx\", function (d) {\r\n                      return valueScale(d[value.Col] * ScaleFactor);\r\n                    });\r\n                }\r\n              });\r\n            }\r\n          }\r\n\r\n          if (panel.ShowValues && panel.ValuePosition != \"top\") {\r\n            SelectedValues.forEach((valueDef, index) => {\r\n              let valueCol = valueDef.Col;\r\n              if (valueCol >= 0) {\r\n                let gap =\r\n                  SelectedValues.length > 1\r\n                    ? (labelScale.bandwidth() * multiBarPadding) /\r\n                    (SelectedValues.length - 1) /\r\n                    100\r\n                    : 0;\r\n                let height =\r\n                  (labelScale.bandwidth() - gap * (SelectedValues.length - 1)) /\r\n                  SelectedValues.length;\r\n\r\n                g1.append(\"text\")\r\n                  .text(function (d) {\r\n                    return (Number(d[valueCol]) * ScaleFactor).toFixed(\r\n                      ValueDecimals\r\n                    );\r\n                  })\r\n                  .attr(\"x\", function (d) {\r\n                    if (panel.ValuePosition == \"bar base\")\r\n                      return valueScale(baseLineValue);\r\n                    else {\r\n                      // \"bar end\"\r\n                      var val = scaleAndClipValue(d[valueCol]);\r\n                      return valueScale(val) + (val > baseLineValue);\r\n                    }\r\n                  })\r\n                  .attr(\"y\", function (d, i) {\r\n                    return (\r\n                      labelScale(d[labelCol]) +\r\n                      height / 2 +\r\n                      (height + gap) * index\r\n                    );\r\n                  })\r\n                  .attr(\"font-family\", \"sans-serif\")\r\n                  .attr(\"font-size\", panel.ValueFontSize)\r\n                  .attr(\"fill\", function (d) {\r\n                    return getValueColor(d, valueDef);\r\n                  })\r\n                  .attr(\"text-anchor\", function (d) {\r\n                    if (panel.ValuePosition == \"bar base\")\r\n                      return d[valueCol] * ScaleFactor > baseLineValue\r\n                        ? \"start\"\r\n                        : \"end\";\r\n                    // \"bar end\"\r\n                    else\r\n                      return d[valueCol] * ScaleFactor > baseLineValue\r\n                        ? \"end\"\r\n                        : \"start\";\r\n                  })\r\n                  .attr(\"dominant-baseline\", \"central\");\r\n              }\r\n            });\r\n          }\r\n\r\n          svg\r\n            .append(\"g\")\r\n            .selectAll(\"rect\")\r\n            .data(stripedata)\r\n            .enter()\r\n            .append(\"rect\")\r\n            .attr(\"width\", w)\r\n            .attr(\"height\", stripeScale.step())\r\n            .attr(\"x\", left)\r\n            .attr(\"y\", function (d) {\r\n              return stripeScale(d);\r\n            })\r\n            .attr(\"fill\", \"rgba(0,0,0,0)\")\r\n            .attr(\"stroke\", OutlineColor)\r\n            .on(\"mouseover\", function (d) {\r\n              if ((tooltipType && Array.isArray(d)) || Links.length)\r\n                tooltipShow(d);\r\n            })\r\n            .on(\"mouseleave\", function () {\r\n              if (!isInTooltip) {\r\n                tooltipHide(false);\r\n              }\r\n            });\r\n\r\n          // Add High Side Value Axis (X)\r\n          if (highSideMargin > 0) {\r\n            var ggHighSide = svg\r\n              .append(\"g\")\r\n              .attr(\"transform\", \"translate(1,\" + (hh + highSideMargin) + \")\")\r\n              .attr(\"class\", \"michaeldmoore-multistat-panel-valueaxis\")\r\n              .call(d3.axisTop(valueScale));\r\n\r\n            ggHighSide\r\n              .selectAll(\".tick text\")\r\n              .attr(\"fill\", panel.HighAxisColor);\r\n\r\n            ggHighSide\r\n              .selectAll(\".tick line\")\r\n              .attr(\"stroke\", panel.HighAxisColor)\r\n              .attr(\"stroke-width\", panel.HighAxisWidth);\r\n\r\n            ggHighSide\r\n              .selectAll(\"path.domain\")\r\n              .attr(\"stroke\", panel.HighAxisColor)\r\n              .attr(\"stroke-width\", panel.HighAxisWidth);\r\n          }\r\n\r\n          // Add Low Side Value Axis (X)\r\n          if (lowSideMargin > 0) {\r\n            var ggLowSide = svg\r\n              .append(\"g\")\r\n              .attr(\r\n                \"transform\",\r\n                \"translate(0,\" + (hh + dh - lowSideMargin) + \")\"\r\n              )\r\n              .attr(\"class\", \"michaeldmoore-multistat-panel-valueaxis\")\r\n              .call(d3.axisBottom(valueScale));\r\n\r\n            ggLowSide.selectAll(\".tick text\").attr(\"fill\", panel.LowAxisColor);\r\n\r\n            ggLowSide\r\n              .selectAll(\".tick line\")\r\n              .attr(\"stroke\", panel.LowAxisColor)\r\n              .attr(\"stroke-width\", panel.LowAxisWidth);\r\n\r\n            ggLowSide\r\n              .selectAll(\"path.domain\")\r\n              .attr(\"stroke\", panel.LowAxisColor)\r\n              .attr(\"stroke-width\", panel.LowAxisWidth);\r\n          }\r\n        };\r\n\r\n        if (this.groupedRows != null) {\r\n          var gcols =\r\n            GroupCols <= 0 || GroupCols > this.groupedRows.length\r\n              ? this.groupedRows.length\r\n              : GroupCols;\r\n          var dw = (w + GroupGap) / gcols;\r\n\r\n          // Figure out the max data points in each row of groups...\r\n          var pointsPerRow = [];\r\n          for (let i = 0; i < this.groupedRows.length / gcols; i++)\r\n            pointsPerRow.push(0);\r\n          for (let i = 0; i < this.groupedRows.length; i++) {\r\n            let rr = Math.floor(i / gcols);\r\n            let u = this.groupedRows[i]/*.values*/[1].length;\r\n            if (pointsPerRow[rr] < u) pointsPerRow[rr] = u;\r\n          }\r\n\r\n          var totalPoints = 0;\r\n          for (let i = 0; i < pointsPerRow.length; i++)\r\n            totalPoints += pointsPerRow[i];\r\n\r\n          var rowOverheadHeight =\r\n            groupNameOffset +\r\n            this.panel.LowSideMargin +\r\n            this.panel.HighSideMargin;\r\n\r\n          var rowHeight =\r\n            (h - (pointsPerRow.length * rowOverheadHeight) - ((pointsPerRow.length - 1) * VGroupGap)) / totalPoints;\r\n\r\n          var numRows = Math.ceil(this.groupedRows.length / gcols);\r\n          var hh = 0;\r\n          for (var rr = 0; rr < numRows; rr++) {\r\n            var nn = pointsPerRow[rr];\r\n            var dh = rowOverheadHeight + (nn * rowHeight);\r\n            hh += dh;\r\n            for (var cc = 0; cc < gcols; cc++) {\r\n              var ii = cc + rr * gcols;\r\n              if (ii < this.groupedRows.length) {\r\n                plotGroupHorizontal(\r\n                  this.panel,\r\n                  this.svg,\r\n                  this.groupedRows[ii][1],\r\n                  nn,\r\n                  this.groupedRows[ii][0],\r\n                  groupNameOffset,\r\n                  cc * dw,\r\n                  dw - GroupGap,\r\n                  hh - dh,\r\n                  dh\r\n                );\r\n              }\r\n            }\r\n            hh += VGroupGap;\r\n          }\r\n        } else {\r\n          plotGroupHorizontal(\r\n            this.panel,\r\n            this.svg,\r\n            this.rows,\r\n            this.rows.length,\r\n            \"\",\r\n            0,\r\n            0,\r\n            w,\r\n            0,\r\n            h\r\n          );\r\n        }\r\n      } else {\r\n        var plotGroupVertical = function (\r\n          panel,\r\n          svg,\r\n          data,\r\n          numRows,\r\n          groupName,\r\n          groupNameOffset,\r\n          left,\r\n          w,\r\n          hh,\r\n          dh\r\n        ) {\r\n          // Draw border rectangle\r\n          /*svg.append(\"rect\")\r\n            .attr(\"width\", w)\r\n            .attr(\"height\", dh)\r\n            .attr(\"x\", left)\r\n            .attr(\"y\", hh)\r\n            .attr(\"stroke\", \"yellow\");*/\r\n\r\n          sortData(data, panel.SortDirection);\r\n\r\n          if (\r\n            panel.Aggregate != \"all\" &&\r\n            labelCol != -1 &&\r\n            SelectedValues.length > 0\r\n          ) {\r\n            //            console.log('data(in) = ' +JSON.stringify(data));\r\n            data = aggregateData(data, panel.Aggregate);\r\n          }\r\n//          console.log('data = ' + JSON.stringify(data));\r\n\r\n          // Add Above-High Side Group Names\r\n          if (groupName != \"\" && panel.ShowGroupLabels) {\r\n            svg\r\n              .append(\"text\")\r\n              .text(groupName)\r\n              .attr(\"x\", left + (labelMargin + w) / 2)\r\n              .attr(\"y\", hh + groupNameOffset / 2)\r\n              .attr(\"font-family\", \"sans-serif\")\r\n              .attr(\"font-size\", panel.GroupLabelFontSize)\r\n              .attr(\"fill\", panel.GroupLabelColor)\r\n              .attr(\"background\", \"blue\")\r\n              .attr(\"text-anchor\", \"middle\")\r\n              .attr(\"dominant-baseline\", \"central\");\r\n          }\r\n\r\n          hh += groupNameOffset;\r\n          dh -= groupNameOffset;\r\n\r\n          // Draw border rectangle\r\n          /*svg.append(\"rect\")\r\n                    .attr(\"width\", w)\r\n                    .attr(\"height\", dh)\r\n                    .attr(\"x\", left)\r\n                    .attr(\"y\", hh)\r\n                    .attr(\"stroke\", \"#ffffff\");*/\r\n\r\n          var labels = data.map(function (d) {\r\n            return d[labelCol];\r\n          });\r\n          while (labels.length < numRows)\r\n            labels = labels.concat(\r\n              \"_\" + Math.random().toString(36).substr(2, 9)\r\n            );\r\n\r\n          var labelScale = d3\r\n            .scaleBand()\r\n            .domain(labels)\r\n            .range([left + lowSideMargin, left + w - highSideMargin])\r\n            .paddingInner(barPadding / 100)\r\n            .paddingOuter(barPadding / 200);\r\n\r\n          var stripedata = data.concat(d3.range(data.length, numRows));\r\n\r\n          var stripeScale = d3\r\n            .scaleBand()\r\n            .domain(stripedata)\r\n            .range([left + lowSideMargin, left + w - highSideMargin]);\r\n\r\n          // Draw background of alternating stripes\r\n          var oddeven = false;\r\n          svg\r\n            .append(\"g\")\r\n            .selectAll(\"rect\")\r\n            .data(stripedata)\r\n            .enter()\r\n            .append(\"rect\")\r\n            .attr(\"class\", \"michaeldmoore-multistat-panel-row\")\r\n            .attr(\"width\", stripeScale.step())\r\n            .attr(\"height\", dh)\r\n            .attr(\"x\", function (d, i) {\r\n              return stripeScale(d);\r\n            })\r\n            .attr(\"y\", hh)\r\n            .attr(\"fill\", function (d) {\r\n              oddeven = !oddeven;\r\n              return oddeven ? OddRowColor : EvenRowColor;\r\n            });\r\n\r\n          var g2 = svg\r\n            .append(\"g\")\r\n            .selectAll(\"text\")\r\n            .data(data)\r\n            .enter()\r\n            .append(\"g\");\r\n\r\n          if (panel.ShowValues && panel.ValuePosition == \"top\") {\r\n            var maxValueHeight = 0;\r\n\r\n            SelectedValues.forEach((valueDef, index) => {\r\n              let valueCol = valueDef.Col;\r\n              if (valueCol >= 0) {\r\n                let gap =\r\n                  SelectedValues.length > 1\r\n                    ? (labelScale.bandwidth() * multiBarPadding) /\r\n                    (SelectedValues.length - 1) /\r\n                    100\r\n                    : 0;\r\n                let width =\r\n                  (labelScale.bandwidth() - gap * (SelectedValues.length - 1)) /\r\n                  SelectedValues.length;\r\n\r\n                g2.append(\"text\")\r\n                  .text(function (d) {\r\n                    return (Number(d[valueCol]) * ScaleFactor).toFixed(\r\n                      ValueDecimals\r\n                    );\r\n                  })\r\n                  .attr(\"x\", function (d, i) {\r\n                    return (\r\n                      labelScale(d[labelCol]) +\r\n                      width / 2 +\r\n                      (width + gap) * index\r\n                    );\r\n                  })\r\n                  .attr(\"y\", hh)\r\n                  .attr(\"font-family\", \"sans-serif\")\r\n                  .attr(\"font-size\", panel.ValueFontSize)\r\n                  .attr(\"fill\", panel.ValueColor)\r\n                  .attr(\"text-anchor\", \"middle\")\r\n                  .attr(\"dominant-baseline\", \"text-before-edge\")\r\n                  .each(function (d, i) {\r\n                    var thisHeight = this.getBBox().height;\r\n                    maxValueHeight = d3.max([maxValueHeight, thisHeight]);\r\n                  });\r\n              }\r\n            });\r\n\r\n            hh += maxValueHeight;\r\n            dh -= maxValueHeight;\r\n          }\r\n\r\n          if (panel.ShowLabels) {\r\n            var maxLabelHeight = 0;\r\n            var labelAngle = Number(panel.LableAngle);\r\n            g2.append(\"text\")\r\n              .text(function (d) {\r\n                return d[labelCol];\r\n              })\r\n              .attr(\"font-family\", \"sans-serif\")\r\n              .attr(\"font-size\", panel.LabelFontSize)\r\n              .attr(\"fill\", function (d, i) {\r\n                if (SelectedValues.length) {\r\n                  // This should check ALL the SelectedValues, not just [0]///////////////////////////////////////////////\r\n                  let minvalue = d[SelectedValues[0].Col] * ScaleFactor;\r\n                  let maxvalue = minvalue;\r\n\r\n                  if (maxvalue > maxLineValue || minvalue < minLineValue)\r\n                    return panel.OutOfRangeLabelColor;\r\n                }\r\n                return panel.LabelColor;\r\n              })\r\n              .attr(\"text-anchor\", \"middle\")\r\n              .attr(\"dominant-baseline\", \"central\")\r\n              .attr(\"transform\", function (d, i) {\r\n                var bbox = this.getBBox();\r\n                var s = Math.sin((labelAngle * Math.PI) / 180);\r\n                var c = Math.cos((labelAngle * Math.PI) / 180);\r\n                var b = Math.abs(bbox.width * s) + Math.abs(bbox.height * c);\r\n                var a = Math.abs(bbox.width * c) + Math.abs(bbox.height * s);\r\n\r\n                var x = labelScale(d[labelCol]) + labelScale.bandwidth() / 2;\r\n                var y = hh + dh - b / 2;\r\n                return (\r\n                  \"translate(\" + x + \",\" + y + \") rotate(\" + labelAngle + \")\"\r\n                );\r\n              })\r\n              .each(function (d, i) {\r\n                var bbox = this.getBBox();\r\n                var s = Math.sin((labelAngle * Math.PI) / 180);\r\n                var c = Math.cos((labelAngle * Math.PI) / 180);\r\n                var b = Math.abs(bbox.width * s) + Math.abs(bbox.height * c);\r\n                var a = Math.abs(bbox.width * c) + Math.abs(bbox.height * s);\r\n\r\n                var thisHeight = b;\r\n                maxLabelHeight = d3.max([maxLabelHeight, thisHeight]);\r\n              });\r\n            if (isNumber(labelMargin)) {\r\n              dh -= labelMargin;\r\n            } else {\r\n              dh -= maxLabelHeight;\r\n            }\r\n          }\r\n\r\n          var valueScale = d3\r\n            .scaleLinear()\r\n            .domain([maxLineValue, minLineValue])\r\n            .range([hh, hh + dh])\r\n            .nice();\r\n\r\n          function hLine(svg, value, color, strokeWidth) {\r\n            svg\r\n              .append(\"line\")\r\n              .style(\"stroke\", color)\r\n              .attr(\"stroke-width\", strokeWidth == null ? 1 : strokeWidth)\r\n              .attr(\"x1\", left + lowSideMargin)\r\n              .attr(\"y1\", valueScale(value))\r\n              .attr(\"x2\", left + w - highSideMargin)\r\n              .attr(\"y2\", valueScale(value));\r\n          }\r\n\r\n          if (panel.ShowBaseLine)\r\n            hLine(svg, baseLineValue, panel.BaseLineColor, panel.BaseLineWidth);\r\n\r\n          if (panel.ShowMaxLine)\r\n            hLine(svg, maxLineValue, panel.MaxLineColor, panel.MaxLineWidth);\r\n\r\n          if (panel.ShowMinLine)\r\n            hLine(svg, minLineValue, panel.MinLineColor, panel.MinLineWidth);\r\n\r\n          if (panel.ShowHighLimitLine)\r\n            hLine(\r\n              svg,\r\n              highLimitValue,\r\n              panel.HighLimitLineColor,\r\n              panel.HighLimitLineWidth\r\n            );\r\n\r\n          if (panel.ShowLowLimitLine)\r\n            hLine(\r\n              svg,\r\n              lowLimitValue,\r\n              panel.LowLimitLineColor,\r\n              panel.LowLimitLineWidth\r\n            );\r\n\r\n          if (panel.ShowBars) {\r\n            SelectedValues.forEach((valueDef, index) => {\r\n              let valueCol = valueDef.Col;\r\n              if (valueCol >= 0) {\r\n                let gap =\r\n                  SelectedValues.length > 1\r\n                    ? (labelScale.bandwidth() * multiBarPadding) /\r\n                    (SelectedValues.length - 1) /\r\n                    100\r\n                    : 0;\r\n                let width =\r\n                  (labelScale.bandwidth() - gap * (SelectedValues.length - 1)) /\r\n                  SelectedValues.length;\r\n\r\n                g2.append(\"rect\")\r\n                  .attr(\"class\", \"michaeldmoore-multistat-panel-bar\")\r\n                  .attr(\"height\", function (d) {\r\n                    var val = scaleAndClipValue(d[valueCol]);\r\n                    return Math.abs(\r\n                      valueScale(baseLineValue) - valueScale(val)\r\n                    );\r\n                  })\r\n                  .attr(\"width\", width)\r\n                  .attr(\"y\", function (d) {\r\n                    var val = scaleAndClipValue(d[valueCol]);\r\n                    return d3.min([valueScale(val), valueScale(baseLineValue)]);\r\n                  })\r\n                  .attr(\"x\", function (d, i) {\r\n                    return labelScale(d[labelCol]) + (width + gap) * index;\r\n                  })\r\n                  .attr(\"fill\", function (d) {\r\n                    return getBarColor(d, valueDef);\r\n                  })\r\n                  .classed(\"highflash\", function (d) {\r\n                    return (\r\n                      recolorHighLimitBar &&\r\n                      flashHighLimitBar &&\r\n                      d[valueCol] * ScaleFactor > highLimitValue\r\n                    );\r\n                  })\r\n                  .classed(\"lowflash\", function (d) {\r\n                    return (\r\n                      recolorLowLimitBar &&\r\n                      flashLowLimitBar &&\r\n                      d[valueCol] * ScaleFactor < lowLimitValue\r\n                    );\r\n                  });\r\n              }\r\n            });\r\n          }\r\n\r\n          if (panel.ShowLines) {\r\n            var bw = labelScale.step();\r\n\r\n            if (panel.LineWidth) {\r\n              var curveFunc = d3.curveLinear;\r\n              switch (panel.CurveType) {\r\n                case \"Linear\":\r\n                  curveFunc = d3.curveLinear;\r\n                  break;\r\n                case \"Monotone\":\r\n                  curveFunc = d3.curveMonotoneX;\r\n                  break;\r\n                case \"Cardinal\":\r\n                  curveFunc = d3.curveCardinal;\r\n                  break;\r\n                case \"Catmull-Rom\":\r\n                  curveFunc = d3.curveCatmullRom;\r\n                  break;\r\n              }\r\n\r\n              var lineFunction = d3\r\n                .line()\r\n                .curve(curveFunc)\r\n                .x(function (d) {\r\n                  return d.x;\r\n                })\r\n                .y(function (d) {\r\n                  return d.y;\r\n                });\r\n\r\n              SelectedValues.forEach((value, index) => {\r\n                let gap =\r\n                  SelectedValues.length > 1\r\n                    ? (labelScale.bandwidth() * multiBarPadding) /\r\n                    (SelectedValues.length - 1) /\r\n                    100\r\n                    : 0;\r\n                let width =\r\n                  (labelScale.bandwidth() - gap * (SelectedValues.length - 1)) /\r\n                  SelectedValues.length;\r\n\r\n                if (panel.LineWidth) {\r\n                  var points = [];\r\n                  for (var i = 0; i < data.length; i++) {\r\n                    var d = data[i];\r\n                    var x =\r\n                      labelScale(d[labelCol]) +\r\n                      width / 2 +\r\n                      (width + gap) * index;\r\n                    var y = valueScale(d[value.Col] * ScaleFactor);\r\n                    points.push({\r\n                      x,\r\n                      y,\r\n                    });\r\n                  }\r\n\r\n                  svg\r\n                    .append(\"path\")\r\n                    .attr(\"d\", lineFunction(points))\r\n                    .attr(\"stroke\", panel.LineColor)\r\n                    .attr(\"stroke-width\", panel.LineWidth)\r\n                    .attr(\"fill\", \"none\");\r\n                }\r\n\r\n                if (panel.DotSize) {\r\n                  g2.append(\"circle\")\r\n                    .attr(\"r\", panel.DotSize / 2.0)\r\n                    .attr(\"fill\", panel.DotColor)\r\n                    .attr(\"cx\", function (d) {\r\n                      return (\r\n                        labelScale(d[labelCol]) +\r\n                        width / 2 +\r\n                        (width + gap) * index\r\n                      );\r\n                    })\r\n                    .attr(\"cy\", function (d) {\r\n                      return valueScale(d[value.Col] * ScaleFactor);\r\n                    });\r\n                }\r\n              });\r\n            }\r\n          }\r\n\r\n          if (panel.ShowValues && panel.ValuePosition != \"top\") {\r\n            SelectedValues.forEach((valueDef, index) => {\r\n              let valueCol = valueDef.Col;\r\n              if (valueCol >= 0) {\r\n                let gap =\r\n                  SelectedValues.length > 1\r\n                    ? (labelScale.bandwidth() * multiBarPadding) /\r\n                    (SelectedValues.length - 1) /\r\n                    100\r\n                    : 0;\r\n                let width =\r\n                  (labelScale.bandwidth() - gap * (SelectedValues.length - 1)) /\r\n                  SelectedValues.length;\r\n\r\n                g2.append(\"text\")\r\n                  .text(function (d) {\r\n                    return (Number(d[valueCol]) * ScaleFactor).toFixed(\r\n                      ValueDecimals\r\n                    );\r\n                  })\r\n                  .attr(\"x\", function (d, i) {\r\n                    return (\r\n                      labelScale(d[labelCol]) +\r\n                      width / 2 +\r\n                      (width + gap) * index\r\n                    );\r\n                  })\r\n                  .attr(\"y\", function (d) {\r\n                    if (ValuePosition == \"bar base\")\r\n                      return valueScale(baseLineValue);\r\n                    else {\r\n                      var val = scaleAndClipValue(d[valueCol]);\r\n                      return valueScale(val);\r\n                    }\r\n                  })\r\n                  .attr(\"font-family\", \"sans-serif\")\r\n                  .attr(\"font-size\", panel.ValueFontSize)\r\n                  .attr(\"fill\", function (d) {\r\n                    return getValueColor(d, valueDef);\r\n                  })\r\n                  .attr(\"text-anchor\", \"middle\")\r\n                  .attr(\"dominant-baseline\", function (d) {\r\n                    if (ValuePosition == \"bar base\")\r\n                      return d[valueCol] * ScaleFactor > baseLineValue\r\n                        ? \"text-after-edge\"\r\n                        : \"text-before-edge\";\r\n                    else\r\n                      return d[valueCol] * ScaleFactor > baseLineValue\r\n                        ? \"text-before-edge\"\r\n                        : \"text-after-edge\";\r\n                  });\r\n              }\r\n            });\r\n          }\r\n\r\n          svg\r\n            .append(\"g\")\r\n            .selectAll(\"rect\")\r\n            .data(stripedata)\r\n            .enter()\r\n            .append(\"rect\")\r\n            .attr(\"width\", stripeScale.step())\r\n            .attr(\"height\", dh)\r\n            .attr(\"x\", function (d) {\r\n              return stripeScale(d);\r\n            })\r\n            .attr(\"y\", hh)\r\n            .attr(\"fill\", \"rgba(0,0,0,0)\")\r\n            .attr(\"stroke\", OutlineColor)\r\n            .on(\"mouseover\", function (d) {\r\n              if ((tooltipType && Array.isArray(d)) || Links.length)\r\n                tooltipShow(d);\r\n            })\r\n            .on(\"mouseleave\", function () {\r\n              if (!isInTooltip) {\r\n                tooltipHide(false);\r\n              }\r\n            });\r\n\r\n          if (lowSideMargin > 0) {\r\n            let ggLowSide = svg\r\n              .append(\"g\")\r\n              .attr(\"transform\", \"translate(\" + (left + lowSideMargin) + \", 0)\")\r\n              .classed(\"michaeldmoore-multistat-panel-valueaxis\", true)\r\n              .call(\r\n                d3\r\n                  .axisLeft(valueScale)\r\n                  .tickSizeInner(5)\r\n                  .tickSizeOuter(10)\r\n                  .ticks(5)\r\n              );\r\n            ggLowSide.selectAll(\".tick text\").attr(\"fill\", panel.LowAxisColor);\r\n            ggLowSide\r\n              .selectAll(\".tick line\")\r\n              .attr(\"stroke\", panel.LowAxisColor)\r\n              .attr(\"stroke-width\", panel.LowAxisWidth);\r\n            ggLowSide\r\n              .selectAll(\"path.domain\")\r\n              .attr(\"stroke\", panel.LowAxisColor)\r\n              .attr(\"stroke-width\", panel.LowAxisWidth);\r\n          }\r\n\r\n          if (highSideMargin > 0) {\r\n            let ggHighSide = svg\r\n              .append(\"g\")\r\n              .attr(\r\n                \"transform\",\r\n                \"translate(\" + (left + w - highSideMargin) + \", 0)\"\r\n              )\r\n              .classed(\"michaeldmoore-multistat-panel-valueaxis\", true)\r\n              .call(\r\n                d3\r\n                  .axisRight(valueScale)\r\n                  .tickSizeInner(5)\r\n                  .tickSizeOuter(10)\r\n                  .ticks(5)\r\n              );\r\n            ggHighSide\r\n              .selectAll(\".tick text\")\r\n              .attr(\"fill\", panel.HighAxisColor);\r\n            ggHighSide\r\n              .selectAll(\".tick line\")\r\n              .attr(\"stroke\", panel.HighAxisColor)\r\n              .attr(\"stroke-width\", panel.HighAxisWidth);\r\n            ggHighSide\r\n              .selectAll(\"path.domain\")\r\n              .attr(\"stroke\", panel.HighAxisColor)\r\n              .attr(\"stroke-width\", panel.HighAxisWidth);\r\n          }\r\n        };\r\n\r\n        let groupNameOffset = this.panel.ShowGroupLabels\r\n          ? Number(this.panel.GroupLabelFontSize.replace(\"%\", \"\")) * 0.15\r\n          : 0;\r\n\r\n        if (this.groupedRows != null) {\r\n          let gcols =\r\n            GroupCols <= 0 || GroupCols > this.groupedRows.length\r\n              ? this.groupedRows.length\r\n              : GroupCols;\r\n          let dw = (w + GroupGap) / gcols;\r\n\r\n          // Figure out the max data points in each column of groups...\r\n          var pointsPerCol = [];\r\n          for (let i = 0; i < gcols; i++) pointsPerCol.push(0);\r\n          for (let i = 0; i < this.groupedRows.length; i++) {\r\n            let cc = i % gcols;\r\n            let u = this.groupedRows[i]/*.values*/[1].length;\r\n            if (pointsPerCol[cc] < u) pointsPerCol[cc] = u;\r\n          }\r\n\r\n          let totalPoints = 0;\r\n          for (let i = 0; i < pointsPerCol.length; i++)\r\n            totalPoints += pointsPerCol[i];\r\n\r\n          var colOverheadWidth =\r\n            this.panel.LowSideMargin + this.panel.HighSideMargin;\r\n          var colWidth =\r\n            (w - pointsPerCol.length * colOverheadWidth) / totalPoints;\r\n\r\n          let numRows = Math.ceil(this.groupedRows.length / gcols);\r\n          let dh = (h - ((numRows - 1) * VGroupGap)) / numRows;\r\n          let hh = dh;\r\n          for (let rr = 0; rr < numRows; rr++) {\r\n            let ww = 0;\r\n            for (let cc = 0; cc < gcols; cc++) {\r\n              let nn = pointsPerCol[cc];\r\n\r\n              let ii = cc + rr * gcols;\r\n              if (ii < this.groupedRows.length) {\r\n                plotGroupVertical(\r\n                  this.panel,\r\n                  this.svg,\r\n                  this.groupedRows[ii][1],\r\n                  nn,\r\n                  this.groupedRows[ii][0],\r\n                  groupNameOffset,\r\n                  ww,\r\n                  dw - GroupGap,\r\n                  hh - dh,\r\n                  dh\r\n                );\r\n                ww += dw;\r\n              }\r\n            }\r\n            hh += dh + VGroupGap;\r\n          }\r\n        } else {\r\n          plotGroupVertical(\r\n            this.panel,\r\n            this.svg,\r\n            this.rows,\r\n            this.rows.length,\r\n            \"\",\r\n            0,\r\n            0,\r\n            w,\r\n            0,\r\n            h\r\n          );\r\n        }\r\n      }\r\n\r\n      var pulseHigh = function (svg) {\r\n        var highFlashRects = svg.selectAll(\r\n          \"rect.michaeldmoore-multistat-panel-bar.highflash\"\r\n        );\r\n\r\n        if (\r\n          isNumber(HighLimitBarFlashTimeout) &&\r\n          highFlashRects._groups.length > 0 &&\r\n          highFlashRects._groups[0].length > 0\r\n        ) {\r\n          highFlashRects.transition().on(\"start\", function highRepeat() {\r\n            d3.active(this)\r\n              .style(\"fill\", HighLimitBarFlashColor)\r\n              .duration(HighLimitBarFlashTimeout)\r\n              .transition()\r\n              .style(\"fill\", HighLimitBarColor)\r\n              .duration(HighLimitBarFlashTimeout)\r\n              .transition()\r\n              .on(\"start\", highRepeat);\r\n          });\r\n        }\r\n      };\r\n\r\n      var pulseLow = function (svg) {\r\n        var lowFlashRects = svg.selectAll(\r\n          \"rect.michaeldmoore-multistat-panel-bar.lowflash\"\r\n        );\r\n        if (\r\n          isNumber(LowLimitBarFlashTimeout) &&\r\n          lowFlashRects._groups.length > 0 &&\r\n          lowFlashRects._groups[0].length > 0\r\n        ) {\r\n          lowFlashRects.transition().on(\"start\", function lowRepeat() {\r\n            d3.active(this)\r\n              .style(\"fill\", LowLimitBarFlashColor)\r\n              .duration(LowLimitBarFlashTimeout)\r\n              .transition()\r\n              .style(\"fill\", LowLimitBarColor)\r\n              .duration(LowLimitBarFlashTimeout)\r\n              .transition()\r\n              .on(\"start\", lowRepeat);\r\n          });\r\n        }\r\n      };\r\n\r\n      pulseHigh(this.svg);\r\n      pulseLow(this.svg);\r\n    }\r\n\r\n    /*\r\n    var drag = d3.drag()\r\n      .on(\"drag\", function () {\r\n        d3.select(this).attr(\"cx\", d3.event.x).attr(\"cy\", d3.event.y);\r\n      });\r\n\r\n    if (!this.panel.Legend) {\r\n      this.svg\r\n        .append(\"rect\")\r\n        .attr(\"x\", 10)\r\n        .attr(\"y\", 20)\r\n        .attr(\"width\", 100)\r\n        .attr(\"height\", 200)\r\n        .attr(\"fill\", \"red\")\r\n        .attr(\"stroke\", \"yellow\")\r\n        .call(this.drag);\r\n    }\r\n*/\r\n\r\n    this.ctrl.renderingCompleted();\r\n  }\r\n\r\n  onConfigChanged() {\r\n    this.refresh();\r\n  }\r\n\r\n  link(scope, elem, attrs, ctrl) {\r\n    this.ctrl = ctrl;\r\n    this.elem = elem;\r\n\r\n    // for backward compatability (grafana 6.6.0 and earlier)\r\n    var panelContentElem = elem.find(\".panel-content\");\r\n    if (panelContentElem.length) this.elem = panelContentElem;\r\n\r\n    CTRL = ctrl;\r\n  }\r\n}\r\n\r\nvar CTRL;\r\n\r\nMultistatPanelCtrl.templateUrl = \"module.html\";\r\n\r\nexport { MultistatPanelCtrl as PanelCtrl };\r\n"]}