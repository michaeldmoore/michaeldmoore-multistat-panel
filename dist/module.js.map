{"version":3,"sources":["../src/module.js"],"names":["MetricsPanelCtrl","_","$","d3","angular","kbn","config","TimeSeries","moment","MultistatPanelCtrl","$scope","$injector","alertSrv","panelDefaults","panel","elem","ctrl","defaults","events","on","onRender","bind","onDataReceived","onDataError","onInitEditMode","className","id","svg","select","append","err","set","data","message","seriesList","render","metricNames","sortDirections","aggregations","fontSizes","addEditorTab","cols","length","html","rows","type","i","columns","text","cols0","concat","dateTimeCol","$title","closest","find","$maxDate","children","last","ShowDate","maxDate","dd","add","TZOffsetHours","DateFormat","toUpperCase","fromNow","show","format","hide","pulseHigh","highFlashRects","selectAll","isNumeric","HighLimitBarFlashTimeout","_groups","transition","highRepeat","active","style","HighLimitBarFlashColor","duration","HighLimitBarColor","pulseLow","lowFlashRects","LowLimitBarFlashTimeout","lowRepeat","LowLimitBarFlashColor","LowLimitBarColor","labelCol","valueCol","sortCol","groupCol","DateTimeColName","LabelColName","ValueColName","SortColName","GroupColName","Aggregate","oo","nest","key","d","rollup","entries","forEach","x","push","value","Object","values","assign","mean","Array","from","max","min","height","$container","h","w","width","SortDirection","ascending","sort","y","comp","buildDateHtml","horizontal","Horizontal","labelMargin","LabelMargin","lowSideMargin","LowSideMargin","highSideMargin","HighSideMargin","interrupt","barPadding","BarPadding","baseLineValue","BaseLineValue","minLineValue","MinLineValue","maxLineValue","MaxLineValue","highBarColor","HighBarColor","lowBarColor","LowBarColor","highLimitValue","HighLimitValue","recolorHighLimitBar","RecolorHighLimitBar","lowLimitValue","LowLimitValue","recolorLowLimitBar","RecolorLowLimitBar","flashHighLimitBar","FlashHighLimitBar","flashLowLimitBar","FlashLowLimitBar","showTooltips","ShowTooltips","TooltipDateFormat","ValueDecimals","OddRowColor","EvenRowColor","GroupSortString","minValue","Number","maxValue","tooltipDiv","attr","tooltipShow","c","cc","toFixed","event","pageX","pageY","tooltipHide","plotGroupHorizontal","numRows","groupName","left","groupNameOffset","valueScale","scaleLinear","domain","range","nice","labels","map","Math","random","toString","substr","labelScale","scaleBand","rangeRound","padding","oddeven","enter","bandwidth","vLine","color","ShowBaseLine","BaseLineColor","ShowMaxLine","MaxLineColor","ShowMinLine","MinLineColor","ShowHighLimitLine","HighLimitLineColor","ShowLowLimitLine","LowLimitLineColor","ww","classed","g","ShowValues","ValueFontSize","ValueColor","ShowLabels","LabelFontSize","LabelColor","gg","call","axisTop","LowAxisColor","axisBottom","HighAxisColor","groupedRows","a","b","aPos","search","bPos","localeCompare","gap","dw","hLine","hh","axisLeft","tickSizeInner","tickSizeOuter","ticks","axisRight","renderingCompleted","refresh","scope","attrs","templateUrl"],"mappings":"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","file":"module.js","sourcesContent":["import {\r\n    MetricsPanelCtrl\r\n} from 'app/plugins/sdk';\r\n\r\nimport \"./css/multistat-panel.css!\";\r\n\r\nimport _ from 'lodash';\r\nimport $ from 'jquery';\r\nimport 'jquery.flot';\r\nimport d3 from './external/d3';\r\nimport angular from 'angular';\r\nimport kbn from 'app/core/utils/kbn';\r\nimport config from 'app/core/config';\r\nimport TimeSeries from 'app/core/time_series2';\r\nimport moment from 'moment';\r\n\r\n\r\nclass MultistatPanelCtrl extends MetricsPanelCtrl {\r\n\r\n    /** @ngInject */\r\n    constructor($scope, $injector, alertSrv) {\r\n        super($scope, $injector);\r\n\r\n        this.alertSrv = alertSrv;\r\n\r\n        var panelDefaults = {\r\n\t\t\t\"BarPadding\": 10,\r\n\t\t\t\"BaseLineColor\": \"red\",\r\n\t\t\t\"BaseLineValue\": 0,\r\n\t\t\t\"DateTimeColName\": \"date\",\r\n\t\t\t\"DateFormat\": \"YYYY-MM-DD HH:mm:ss\",\r\n\t\t\t\"TooltipDateFormat\": \"YYYY-MM-DD HH:mm:ss\",\r\n\t\t\t\"FlashHighLimitBar\": false,\r\n\t\t\t\"FlashLowLimitBar\": false,\r\n\t\t\t\"HighAxisColor\": \"white\",\r\n\t\t\t\"HighBarColor\": \"rgb(120, 128, 0)\",\r\n\t\t\t\"HighLimitBarColor\": \"red\",\r\n\t\t\t\"HighLimitBarFlashColor\": \"orange\",\r\n\t\t\t\"HighLimitBarFlashTimeout\": 1000,\r\n\t\t\t\"HighLimitLineColor\": \"red\",\r\n\t\t\t\"HighLimitValue\": 0.33,\r\n\t\t\t\"HighSideMargin\": 20,\r\n\t\t\t\"Horizontal\": false,\r\n\t\t\t\"LabelColName\": \"sensor\",\r\n\t\t\t\"LabelColor\": \"white\",\r\n\t\t\t\"LabelFontSize\": \"100%\",\r\n\t\t\t\"LabelMargin\": null,\r\n\t\t\t\"LowAxisColor\": \"white\",\r\n\t\t\t\"LowBarColor\": \"teal\",\r\n\t\t\t\"LowLimitBarColor\": \"red\",\r\n\t\t\t\"LowLimitBarFlashColor\": \"orange\",\r\n\t\t\t\"LowLimitBarFlashTimeout\": 200,\r\n\t\t\t\"LowLimitLineColor\": \"red\",\r\n\t\t\t\"LowLimitValue\": null,\r\n\t\t\t\"LowSideMargin\": 20,\r\n\t\t\t\"MaxLineColor\": \"rgb(74, 232, 12)\",\r\n\t\t\t\"MaxLineValue\": 1,\r\n\t\t\t\"MinLineValue\": 0,\r\n\t\t\t\"RecolorHighLimitBar\": true,\r\n\t\t\t\"RecolorLowLimitBar\": false,\r\n\t\t\t\"ShowBaseLine\": true,\r\n\t\t\t\"ShowDate\": false,\r\n\t\t\t\"Aggregate\": \"Last\",\r\n\t\t\t\"ShowHighLimitLine\": true,\r\n\t\t\t\"ShowLabels\": true,\r\n\t\t\t\"ShowLeftAxis\": true,\r\n\t\t\t\"ShowLowLimitLine\": false,\r\n\t\t\t\"ShowMaxLine\": false,\r\n\t\t\t\"ShowMinLine\": true,\r\n\t\t\t\"ShowRightAxis\": true,\r\n\t\t\t\"ShowTooltips\": true,\r\n\t\t\t\"ShowValues\": true,\r\n\t\t\t\"SortColName\": \"value\",\r\n\t\t\t\"SortDirection\": \"ascending\",\r\n\t\t\t\"TZOffsetHours\": 0,\r\n\t\t\t\"ValueColName\": \"value\",\r\n\t\t\t\"ValueDecimals\": 2,\r\n\t\t\t\"ValueColor\": \"white\",\r\n\t\t\t\"ValueFontSize\": \"100%\",\r\n\t\t\t\"OddRowColor\": \"rgba(33, 33, 34, 0.92)\",\r\n\t\t\t\"EvenRowColor\": \"rgba(61, 61, 64, 0.78)\",\r\n\t\t\t\"GroupSortString\": \"\"\r\n\t\t\t};\r\n\r\n        var panel = {};\r\n        var elem = {};\r\n        var ctrl = {};\r\n\t\t\r\n        _.defaults(this.panel, panelDefaults);\r\n\r\n        this.events.on('render', this.onRender.bind(this));\r\n        this.events.on('data-received', this.onDataReceived.bind(this));\r\n        this.events.on('data-error', this.onDataError.bind(this));\r\n        this.events.on('init-edit-mode', this.onInitEditMode.bind(this));\r\n\r\n\t\tthis.className = 'michaeldmoore-multistat-panel-' + this.panel.id;\r\n\t\tthis.svg = d3.select('.' + this.className).append('svg');\t\r\n    }\r\n\r\n    onDataError(err) {\r\n        this.alertSrv.set('Multistat Data Error', err.data.message == 'Found no column named time' ? 'Time-Series queries not yet supported' : err.data.message, 'error', 5000);\r\n        this.seriesList = [];\r\n\t\tthis.data = [];\r\n        this.render();\r\n    }\r\n\r\n    onInitEditMode() {\r\n\t\tthis.metricNames = ['min', 'max', 'avg', 'current', 'total', 'name', 'first', 'delta', 'diff', 'range'];\r\n\t\tthis.sortDirections = ['none', 'ascending', 'descending'];\r\n\t\tthis.aggregations = ['all', 'last', 'first', 'mean', 'max', 'min'];\r\n        this.fontSizes = ['20%', '30%', '50%', '70%', '80%', '100%', '110%', '120%', '150%', '170%', '200%'];\r\n        this.addEditorTab('Columns', 'public/plugins/michaeldmoore-multistat-panel/columns.html', 2);\r\n        this.addEditorTab('Layout', 'public/plugins/michaeldmoore-multistat-panel/layout.html', 3);\r\n        this.addEditorTab('Lines & Limits', 'public/plugins/michaeldmoore-multistat-panel/linesandlimits.html', 4);\r\n    }\r\n\r\n\r\n    onDataReceived(data) {\r\n\t\tthis.cols = [];\r\n\t\tif (data.length == 0){\r\n\t\t\tthis.elem.html(\"<div style='position:absolute;top:50%;text-align:center;font-size:0.875rem;'>No data to show</div>\");\r\n\t\t\tthis.data = data;\r\n\t\t\tthis.rows = null;\r\n\t\t\tthis.render();\r\n\t\t}\r\n\t\telse if (data[0].type == \"table\"){\r\n\t\t\tthis.data = data[0];\r\n\r\n\t\t\tfor(var i=0; i < this.data.columns.length; i++)\r\n\t\t\t\tthis.cols[i] = this.data.columns[i].text;\r\n\t\t\tthis.cols0 = [''].concat(this.cols);\r\n\r\n\t\t\tthis.render();\r\n\t\t}\r\n\t\telse {\r\n          this.alertSrv.set('Multistat Data Error', 'Query type \"' + data[0].type + '\", not supported', 'error', 5000);\r\n\t\t}\r\n    }\r\n\r\n\tbuildDateHtml(dateTimeCol){\r\n\t\tvar $title = this.elem.closest('.panel-container').find('.panel-title');\r\n\t\tvar $maxDate = $title.find('span.michaeldmoore-multistat-panel-maxDate');\r\n\r\n\t\tif($maxDate.length == 0)\r\n\t\t\t$maxDate = $title.append('<span class=\"michaeldmoore-multistat-panel-maxDate\"/>').children().last();\r\n\r\n\t\tif (dateTimeCol != -1 && this.panel.ShowDate) {\r\n\t\t\tvar maxDate = this.rows[0][dateTimeCol];\r\n\r\n\t\t\tfor(var i = 1; i < this.rows.length; i++){\r\n\t\t\t\tif (maxDate < this.rows[i][dateTimeCol])\r\n\t\t\t\t\tmaxDate = this.rows[i][dateTimeCol];\r\n\t\t\t}\r\n\t\t\t\r\n\t\t\tvar dd = moment(maxDate).add(this.panel.TZOffsetHours, 'h');\r\n\t\t\t\r\n\t\t\tif (this.panel.DateFormat.toUpperCase() == 'ELAPSED')\r\n\t\t\t\t$maxDate.text(dd.fromNow()).show();\r\n\t\t\telse\r\n\t\t\t\t$maxDate.text(dd.format(this.panel.DateFormat)).show();\r\n\t\t}\r\n\t\telse\r\n\t\t\t$maxDate.hide();\t\t\t\r\n\t}\r\n\r\n\r\n    onRender() {\r\n\t\tif (this.data != null && this.data.rows != null) {\r\n\t\t\tvar cols = this.cols;\r\n\t\t\tvar dateTimeCol = -1;\r\n\t\t\tvar labelCol = -1;\r\n\t\t\tvar valueCol = 0;\r\n\t\t\tvar sortCol = 0;\r\n\t\t\tvar groupCol = -1;\r\n\t\t\tfor(var i=0; i < cols.length; i++){\r\n\t\t\t\tif (cols[i] == this.panel.DateTimeColName)\r\n\t\t\t\t\tdateTimeCol = i;\r\n\t\t\t\tif (cols[i] == this.panel.LabelColName)\r\n\t\t\t\t\tlabelCol = i;\r\n\t\t\t\tif (cols[i] == this.panel.ValueColName)\r\n\t\t\t\t\tvalueCol = i;\r\n\t\t\t\tif (cols[i] == this.panel.SortColName)\r\n\t\t\t\t\tsortCol = i;\r\n\t\t\t\tif (cols[i] == this.panel.GroupColName)\r\n\t\t\t\t\tgroupCol = i;\r\n\t\t\t}\r\n\r\n\t\t\r\n\t\t\tif (this.panel.Aggregate != 'all' && labelCol != -1){\r\n\t\t\t\tvar oo = [];\r\n\t\t\t\tthis.rows = [];\r\n\t\t\t\tswitch(this.panel.Aggregate) {\r\n\t\t\t\t\tcase 'first':\r\n\t\t\t\t\t\tthis.rows = d3.nest()\r\n\t\t\t\t\t\t\t.key(function(d){return d[labelCol]})\r\n\t\t\t\t\t\t\t.rollup(function(d){return d[0]})\r\n\t\t\t\t\t\t\t.entries(this.data.rows)\r\n\t\t\t\t\t\t\t.forEach(function(x){oo.push(x.value); });\r\n\t\t\t\t\t\tthis.rows = oo;\r\n\t\t\t\t\tbreak;\r\n\r\n\t\t\t\t\tcase 'last':\r\n\t\t\t\t\t\tthis.rows = d3.nest()\r\n\t\t\t\t\t\t\t.key(function(d){return d[labelCol]})\r\n\t\t\t\t\t\t\t.rollup(function(d){return d[d.length - 1]})\r\n\t\t\t\t\t\t\t.entries(this.data.rows)\r\n\t\t\t\t\t\t\t.forEach(function(x){oo.push(x.value); });\r\n\t\t\t\t\t\tthis.rows = oo;\r\n\t\t\t\t\tbreak;\r\n\r\n\t\t\t\t\tcase 'mean':\r\n\t\t\t\t\t\tthis.rows = d3.nest()\r\n\t\t\t\t\t\t\t.key(function(d){return d[labelCol]})\r\n\t\t\t\t\t\t\t.rollup(function(d){\r\n\t\t\t\t\t\t\t\tvar dd = Object.values(Object.assign({}, d[d.length - 1]));\r\n\t\t\t\t\t\t\t\tdd[valueCol] = d3.mean(d, function(d) { return d[valueCol];});\r\n\t\t\t\t\t\t\t\treturn dd;\r\n\t\t\t\t\t\t\t\t})\r\n\t\t\t\t\t\t\t.entries(this.data.rows)\r\n\t\t\t\t\t\t\t.forEach(function(x){oo.push(x.value); });\r\n\t\t\t\t\t\tthis.rows = Array.from(oo);\r\n\t\t\t\t\tbreak;\r\n\r\n\t\t\t\t\tcase 'max':\r\n\t\t\t\t\t\tthis.rows = d3.nest()\r\n\t\t\t\t\t\t\t.key(function(d){return d[labelCol]})\r\n\t\t\t\t\t\t\t.rollup(function(d){\r\n\t\t\t\t\t\t\t\tvar dd = Object.values(Object.assign({}, d[d.length - 1]));\r\n\t\t\t\t\t\t\t\tdd[valueCol] = d3.max(d, function(d) { return d[valueCol];});\r\n\t\t\t\t\t\t\t\treturn dd;\r\n\t\t\t\t\t\t\t\t})\r\n\t\t\t\t\t\t\t.entries(this.data.rows)\r\n\t\t\t\t\t\t\t.forEach(function(x){oo.push(x.value); });\r\n\t\t\t\t\t\tthis.rows = Array.from(oo);\r\n\t\t\t\t\tbreak;\r\n\r\n\t\t\t\t\tcase 'min':\r\n\t\t\t\t\t\tthis.rows = d3.nest()\r\n\t\t\t\t\t\t\t.key(function(d){return d[labelCol]})\r\n\t\t\t\t\t\t\t.rollup(function(d){\r\n\t\t\t\t\t\t\t\tvar dd = Object.values(Object.assign({}, d[d.length - 1]));\r\n\t\t\t\t\t\t\t\tdd[valueCol] = d3.min(d, function(d) { return d[valueCol];});\r\n\t\t\t\t\t\t\t\treturn dd;\r\n\t\t\t\t\t\t\t\t})\r\n\t\t\t\t\t\t\t.entries(this.data.rows)\r\n\t\t\t\t\t\t\t.forEach(function(x){oo.push(x.value); });\r\n\t\t\t\t\t\tthis.rows = Array.from(oo);\r\n\t\t\t\t\tbreak;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\telse {\r\n\t\t\t\tthis.rows = this.data.rows;\r\n\t\t\t}\t\t\r\n\r\n\t\t\t\r\n\t\t\tthis.elem.html(\"<svg class='\" + this.className + \"'  style='height:\" + this.ctrl.height + \"px; width:100%'></svg>\");\r\n\t\t\tvar $container = this.elem.find('.' + this.className);\r\n\r\n\t\t\tvar h = $container.height();\r\n\t\t\tvar w = $container.width() - 15;\r\n\r\n\t\t\tif (this.panel.SortDirection != \"none\"){\r\n\t\t\t\tvar ascending = this.panel.SortDirection == \"ascending\";\r\n\t\t\t\tthis.rows.sort(function(x, y){\r\n\t\t\t\t\tvar comp = (x[sortCol] == y[sortCol]) ? 0 : ((x[sortCol] > y[sortCol]) ? 1 : -1);\r\n\t\t\t\t\treturn ascending ? comp : -comp;\r\n\t\t\t\t});\t\t\t\t\r\n\t\t\t}\r\n\t\t\t\r\n\t\t\tthis.buildDateHtml(dateTimeCol);\r\n\t\t\t\r\n\t\t\tvar horizontal = this.panel.Horizontal;\r\n\t\t\t\r\n\t\t\tvar labelMargin = ($.isNumeric(this.panel.LabelMargin) && this.panel.LabelMargin >= 0) ? this.panel.LabelMargin : (horizontal ? 100 : 20);\r\n\t\t\tvar lowSideMargin = this.panel.LowSideMargin >= 0 ? this.panel.LowSideMargin : 0;\r\n\t\t\tvar highSideMargin = this.panel.HighSideMargin >= 0 ? this.panel.HighSideMargin : 0;\r\n\r\n\t\t\tthis.svg.selectAll(\"rect.michaeldmoore-multistat-panel-bar.highflash\").interrupt();\r\n\t\t\tthis.svg.selectAll(\"rect.michaeldmoore-multistat-panel-bar.lowflash\").interrupt();\r\n\r\n\t\t\tthis.svg = d3.select('.' + this.className).append('svg');\t\r\n\t\t\t\r\n\r\n\t\t\tvar barPadding = this.panel.BarPadding;\r\n\t\t\tvar baseLineValue = this.panel.BaseLineValue;\r\n\t\t\tvar minLineValue = this.panel.MinLineValue;\r\n\t\t\tvar maxLineValue = this.panel.MaxLineValue;\r\n\t\t\tvar highBarColor = this.panel.HighBarColor;\r\n\t\t\tvar lowBarColor = this.panel.LowBarColor;\r\n\t\t\tvar highLimitValue = this.panel.HighLimitValue;\r\n\t\t\tvar HighLimitBarColor = this.panel.HighLimitBarColor;\r\n\t\t\tvar HighLimitBarFlashColor = this.panel.HighLimitBarFlashColor;\r\n\t\t\tvar HighLimitBarFlashTimeout = this.panel.HighLimitBarFlashTimeout;\r\n\t\t\tvar recolorHighLimitBar = this.panel.RecolorHighLimitBar;\r\n\t\t\tvar lowLimitValue = this.panel.LowLimitValue;\r\n\t\t\tvar LowLimitBarColor = this.panel.LowLimitBarColor;\r\n\t\t\tvar LowLimitBarFlashColor = this.panel.LowLimitBarFlashColor;\r\n\t\t\tvar LowLimitBarFlashTimeout = this.panel.LowLimitBarFlashTimeout;\r\n\t\t\tvar recolorLowLimitBar = this.panel.RecolorLowLimitBar;\r\n\t\t\tvar flashHighLimitBar = this.panel.FlashHighLimitBar;\r\n\t\t\tvar flashLowLimitBar = this.panel.FlashLowLimitBar;\r\n\t\t\tvar showTooltips = this.panel.ShowTooltips;\r\n\t\t\tvar DateTimeColName = this.panel.DateTimeColName;\r\n\t\t\tvar DateFormat = this.panel.DateFormat;\r\n\t\t\tvar TooltipDateFormat = this.panel.TooltipDateFormat;\r\n\t\t\tvar ValueColName = this.panel.ValueColName;\r\n\t\t\tvar ValueDecimals = this.panel.ValueDecimals;\r\n\t\t\tvar OddRowColor = this.panel.OddRowColor;\r\n\t\t\tvar EvenRowColor = this.panel.EvenRowColor;\r\n\t\t\tvar TZOffsetHours = this.panel.TZOffsetHours;\r\n\t\t\tvar GroupSortString = this.panel.GroupSortString;\r\n\t\t\t\r\n\t\t\tvar minValue = d3.min(this.rows, function(d) { return Number(d[valueCol]); });\r\n\t\t\tif ($.isNumeric(minLineValue) == false || minLineValue > minValue)\r\n\t\t\t\tminLineValue = minValue;\r\n\t\t\t\r\n\t\t\tvar maxValue = d3.max(this.rows, function(d) { return Number(d[valueCol]); });\r\n\t\t\tif ($.isNumeric(maxLineValue) == false || maxLineValue < maxValue)\r\n\t\t\t\tmaxLineValue = maxValue;\t\t\t\t\r\n\t\t\t\r\n\t\t\tif ($.isNumeric(baseLineValue) == false)\r\n\t\t\t\tbaseLineValue = 0;\r\n\t\t\t\r\n\t\t\tif (minLineValue > baseLineValue)\r\n\t\t\t\tminLineValue = baseLineValue;\r\n\t\t\t\r\n\t\t\tif ($.isNumeric(lowLimitValue) && minLineValue > lowLimitValue)\r\n\t\t\t\tminLineValue = lowLimitValue;\r\n\t\t\t\r\n\t\t\tif (maxLineValue < baseLineValue)\r\n\t\t\t\tmaxLineValue = baseLineValue;\r\n\t\t\t\r\n\t\t\tif ($.isNumeric(highLimitValue) && maxLineValue < highLimitValue)\r\n\t\t\t\tmaxLineValue = highLimitValue;\r\n\r\n\t\t\tvar tooltipDiv = d3.select(\"body\").append(\"div\")\r\n\t\t\t\t.attr(\"class\", \"michaeldmoore-multistat-panel-tooltip michaeldmoore-multistat-panel-tooltip-\" + this.panel.id)\r\n\t\t\t\t.style(\"opacity\", 0);\r\n\t\t\t\r\n\t\t\t\r\n\t\t\tvar tooltipShow = function(d, c){\r\n\t\t\t\ttooltipDiv.transition()\r\n\t\t\t\t.duration(200)\r\n\t\t\t\t.style(\"opacity\", .9);\r\n\t\t\t\tvar html = \"<table>\";\r\n\t\t\t\tfor (i = 0; i < d.length; i++){\r\n\t\t\t\t\tvar cc = c[i];\r\n\t\t\t\t\tvar dd = d[i];\r\n\t\t\t\t\t\r\n\t\t\t\t\tif (cc == DateTimeColName)\r\n\t\t\t\t\t\tdd = moment(dd).add(TZOffsetHours, 'h').format(TooltipDateFormat);\r\n\t\t\t\t\telse if (cc == ValueColName && $.isNumeric(dd))\r\n\t\t\t\t\t\tdd = dd.toFixed(ValueDecimals);\r\n\t\t\t\t\t\r\n\t\t\t\t\thtml += \"<tr><td>\" + cc + \"</td><td>\" + dd + \"</td></tr>\";\r\n\t\t\t\t}\r\n\t\t\t\thtml += \"</table>\";\r\n\t\t\t\ttooltipDiv.html(html)\r\n\t\t\t\t.style(\"left\", d3.event.pageX + \"px\")\r\n\t\t\t\t.style(\"top\", (d3.event.pageY - 28) + \"px\");\r\n\t\t\t}\r\n\r\n\t\t\tvar tooltipHide = function() {\r\n\t\t\t\ttooltipDiv.transition()\t\t\r\n\t\t\t\t.duration(500)\t\t\r\n\t\t\t\t.style(\"opacity\", 0);\t\r\n\t\t\t}\r\n\t\t\t\r\n\t\t\tif(horizontal) {\r\n\t\t\t\tvar plotGroupHorizontal = function(panel, svg, data, numRows, groupName, left, w) {\r\n\t\t\t\t\tvar groupNameOffset = groupName != '' ? 15 : 0;\r\n\t\t\t\t\tlowSideMargin += groupNameOffset;\r\n\r\n\t\t\t\t\tvar valueScale = d3.scaleLinear()\r\n\t\t\t\t\t\t\t\t.domain([minLineValue, maxLineValue])\r\n\t\t\t\t\t\t\t\t.range([left + labelMargin, left + w])\r\n\t\t\t\t\t\t\t\t.nice();\r\n\t\t\t\t\t\r\n\t\t\t\t\tvar labels = data.map(function(d){ return d[labelCol]; });\r\n\t\t\t\t\twhile (labels.length < numRows)\r\n\t\t\t\t\t\tlabels = labels.concat('_' + Math.random().toString(36).substr(2, 9));\r\n\t\t\t\t\t\r\n\r\n\t\t\t\t\tvar labelScale = d3.scaleBand()\r\n\t\t\t\t\t\t\t\t.domain(labels)\r\n\t\t\t\t\t\t\t\t.rangeRound([lowSideMargin, h - highSideMargin])\r\n\t\t\t\t\t\t\t\t.padding(barPadding / 100);\r\n\t\t\t\t\r\n\t\t\t\t\t// Draw background of alternating stripes \r\n\t\t\t\t\tvar oddeven = false;\r\n\t\t\t\t\tsvg.append(\"g\")\r\n\t\t\t\t\t\t.selectAll(\"rect\")\r\n\t\t\t\t\t\t.data(data)\r\n\t\t\t\t\t\t.enter()\r\n\t\t\t\t\t\t.append(\"rect\")\r\n\t\t\t\t\t\t.attr(\"class\", \"michaeldmoore-multistat-panel-row\")\r\n\t\t\t\t\t\t.attr(\"width\", w)\r\n\t\t\t\t\t\t.attr(\"height\", labelScale.bandwidth())\r\n\t\t\t\t\t\t.attr(\"x\", left)\r\n\t\t\t\t\t\t.attr(\"y\", function(d,i){return labelScale(d[labelCol])})\r\n\t\t\t\t\t\t.attr(\"fill\", function(d) { \r\n\t\t\t\t\t\t\t\toddeven = !oddeven;\r\n\t\t\t\t\t\t\t\treturn oddeven ? OddRowColor : EvenRowColor;\r\n\t\t\t\t\t\t\t});\r\n\r\n\t\t\t\t\tfunction vLine(svg, value, color) {\t\r\n\t\t\t\t\t\tsvg.append(\"line\")\r\n\t\t\t\t\t\t\t.style(\"stroke\", color)\r\n\t\t\t\t\t\t\t.attr(\"y1\", lowSideMargin)\r\n\t\t\t\t\t\t\t.attr(\"x1\", valueScale(value))\r\n\t\t\t\t\t\t\t.attr(\"y2\", h - highSideMargin)\r\n\t\t\t\t\t\t\t.attr(\"x2\", valueScale(value));\r\n\t\t\t\t\t}\t\t\t\r\n\r\n\t\t\t\t\tif(panel.ShowBaseLine)\r\n\t\t\t\t\t\tvLine(svg, baseLineValue, panel.BaseLineColor);\r\n\r\n\t\t\t\t\tif(panel.ShowMaxLine)\r\n\t\t\t\t\t\tvLine(svg, maxLineValue, panel.MaxLineColor);\r\n\r\n\t\t\t\t\tif(panel.ShowMinLine)\r\n\t\t\t\t\t\tvLine(svg, minLineValue, panel.MinLineColor);\r\n\r\n\t\t\t\t\tif(panel.ShowHighLimitLine)\r\n\t\t\t\t\t\tvLine(svg, highLimitValue, panel.HighLimitLineColor);\r\n\r\n\t\t\t\t\tif(panel.ShowLowLimitLine)\r\n\t\t\t\t\t\tvLine(svg, lowLimitValue, panel.LowLimitLineColor);\r\n\r\n\t\t\t\t\tsvg\r\n\t\t\t\t\t\t.append(\"g\")\r\n\t\t\t\t\t\t.selectAll(\"rect\")\r\n\t\t\t\t\t\t.data(data)\r\n\t\t\t\t\t\t.enter()\r\n\t\t\t\t\t\t.append(\"rect\")\r\n\t\t\t\t\t\t.attr(\"class\", \"michaeldmoore-multistat-panel-bar\")\r\n\t\t\t\t\t\t.attr(\"width\", function(d) { \r\n\t\t\t\t\t\t\tvar ww = valueScale(d[valueCol]) - valueScale(baseLineValue);\r\n\t\t\t\t\t\t\tif (ww < 0)\r\n\t\t\t\t\t\t\t\tww = -ww;\r\n\t\t\t\t\t\t\treturn ww; \r\n\t\t\t\t\t\t\t})\r\n\t\t\t\t\t\t.attr(\"height\", labelScale.bandwidth())\r\n\t\t\t\t\t\t.attr(\"x\", function(d) { \r\n\t\t\t\t\t\t\treturn d3.min([valueScale(d[valueCol]), valueScale(baseLineValue)]); \r\n\t\t\t\t\t\t\t})\r\n\t\t\t\t\t\t.attr(\"y\", function(d,i){return labelScale(d[labelCol])})\r\n\t\t\t\t\t\t.attr(\"fill\", function(d) { \r\n\t\t\t\t\t\t\tif (recolorHighLimitBar && (d[valueCol] > highLimitValue))\r\n\t\t\t\t\t\t\t\treturn HighLimitBarColor;\r\n\t\t\t\t\t\t\tif (recolorLowLimitBar && (d[valueCol] < lowLimitValue))\r\n\t\t\t\t\t\t\t\treturn LowLimitBarColor;\r\n\t\t\t\t\t\t\treturn (d[valueCol] > baseLineValue) ? highBarColor : lowBarColor;\r\n\t\t\t\t\t\t\t})\r\n\t\t\t\t\t\t.classed(\"highflash\", function(d) { \r\n\t\t\t\t\t\t\treturn recolorHighLimitBar && flashHighLimitBar && (d[valueCol] > highLimitValue);\r\n\t\t\t\t\t\t\t})\r\n\t\t\t\t\t\t.classed(\"lowflash\", function(d) { \r\n\t\t\t\t\t\t\treturn recolorLowLimitBar && flashLowLimitBar && (d[valueCol] < lowLimitValue);\r\n\t\t\t\t\t\t\t})\r\n\t\t\t\t\t\t.on(\"mouseover\", function(d) {\r\n\t\t\t\t\t\t\tif (showTooltips)\r\n\t\t\t\t\t\t\t\ttooltipShow(d, cols);\r\n\t\t\t\t\t\t\t})\r\n\t\t\t\t\t\t.on(\"mouseout\", function() { \r\n\t\t\t\t\t\t\ttooltipHide();\r\n\t\t\t\t\t\t\t});\r\n\r\n\t\t\t\t\tvar g = svg\r\n\t\t\t\t\t\t\t.append(\"g\")\r\n\t\t\t\t\t\t\t.selectAll(\"text\")\r\n\t\t\t\t\t\t\t.data(data)\r\n\t\t\t\t\t\t\t.enter()\r\n\t\t\t\t\t\t\t.append(\"g\");\r\n\t\t\t\t\t\r\n\t\t\t\t\tif (panel.ShowValues) {\r\n\t\t\t\t\t\tg.append(\"text\")\r\n\t\t\t\t\t\t//.text(function(d) {return formatDecimal(d[valueCol])})\r\n\t\t\t\t\t\t.text(function(d) {return d[valueCol].toFixed(ValueDecimals)})\r\n\t\t\t\t\t\t.attr(\"x\", function(d){return valueScale(d[valueCol]) + ((d[valueCol] > baseLineValue) ? - 5 : + 5)})\r\n\t\t\t\t\t\t.attr(\"y\", function(d,i){return labelScale(d[labelCol]) + (labelScale.bandwidth() / 2)})\r\n\t\t\t\t\t\t.attr(\"font-family\", \"sans-serif\")\r\n\t\t\t\t\t\t.attr(\"font-size\", panel.ValueFontSize)\r\n\t\t\t\t\t\t.attr(\"fill\", panel.ValueColor)\r\n\t\t\t\t\t\t.attr(\"text-anchor\", function(d){return (d[valueCol] > baseLineValue) ? \"end\" : \"start\";})\r\n\t\t\t\t\t\t.attr(\"dominant-baseline\", \"central\");\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tif (panel.ShowLabels) {\r\n\t\t\t\t\t\tg.append(\"text\")\r\n\t\t\t\t\t\t.text(function(d) { return d[labelCol]; })\r\n\t\t\t\t\t\t.attr(\"x\", left + labelMargin - 5)\r\n\t\t\t\t\t\t.attr(\"y\", function(d,i){return labelScale(d[labelCol]) + (labelScale.bandwidth() / 2)})\r\n\t\t\t\t\t\t.attr(\"font-family\", \"sans-serif\")\r\n\t\t\t\t\t\t.attr(\"font-size\", panel.LabelFontSize)\r\n\t\t\t\t\t\t.attr(\"fill\", panel.LabelColor)\r\n\t\t\t\t\t\t.attr(\"text-anchor\", \"end\")\r\n\t\t\t\t\t\t.attr(\"dominant-baseline\", \"central\");\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\t// Add Low Side Group Names\r\n\t\t\t\t\tif(groupName != '') {\r\n\t\t\t\t\t\tsvg\r\n\t\t\t\t\t\t\t.append(\"text\")\r\n\t\t\t\t\t\t\t.text(groupName)\r\n\t\t\t\t\t\t\t.attr(\"x\", left + ((labelMargin + w - left)/2) - 5)\r\n\t\t\t\t\t\t\t.attr(\"y\", 5)\r\n\t\t\t\t\t\t\t.attr(\"font-family\", \"sans-serif\")\r\n\t\t\t\t\t\t\t.attr(\"font-size\", panel.LabelFontSize)\r\n\t\t\t\t\t\t\t.attr(\"fill\", panel.LabelColor)\r\n\t\t\t\t\t\t\t.attr(\"text-anchor\", \"middle\")\r\n\t\t\t\t\t\t\t.attr(\"dominant-baseline\", \"central\");\r\n\t\t\t\t\t}\r\n\t\t\t\t\t\r\n\t\t\t\t\t//Add Low Side Value Axis (X)\r\n\t\t\t\t\tif (lowSideMargin > groupNameOffset) {\t\r\n\t\t\t\t\t\tvar gg = svg\r\n\t\t\t\t\t\t\t\t.append(\"g\")\r\n\t\t\t\t\t\t\t\t.attr(\"transform\", 'translate(0,' + lowSideMargin + ')')\r\n\t\t\t\t\t\t\t\t.attr(\"class\", \"michaeldmoore-multistat-panel-valueaxis\")\r\n\t\t\t\t\t\t\t\t.call(d3.axisTop(valueScale));\r\n\t\t\t\t\t\tgg.selectAll('.tick text').attr('fill', panel.LowAxisColor);\r\n\t\t\t\t\t\tgg.selectAll('.tick line').attr('stroke', panel.LowAxisColor);\r\n\t\t\t\t\t\tgg.selectAll('path.domain').attr('stroke', panel.LowAxisColor);\r\n\t\t\t\t\t}\r\n\t\t\t\t\t\r\n\t\t\t\t\t//Add High Side Value Axis (X)\r\n\t\t\t\t\tif (highSideMargin > 0) {\t\r\n\t\t\t\t\t\tvar gg = svg\r\n\t\t\t\t\t\t\t\t.append(\"g\")\r\n\t\t\t\t\t\t\t\t.attr(\"transform\", 'translate(0,' + (h - highSideMargin) + ')')\r\n\t\t\t\t\t\t\t\t.attr(\"class\", \"michaeldmoore-multistat-panel-valueaxis\")\r\n\t\t\t\t\t\t\t\t.call(d3.axisBottom(valueScale));\r\n\t\t\t\t\t\tgg.selectAll('.tick text').attr('fill', panel.HighAxisColor);\r\n\t\t\t\t\t\tgg.selectAll('.tick line').attr('stroke', panel.HighAxisColor);\r\n\t\t\t\t\t\tgg.selectAll('path.domain').attr('stroke', panel.HighAxisColor);\r\n\t\t\t\t\t}\r\n\t\t\t\t\t\r\n\t\t\t\t\tlowSideMargin -= groupNameOffset;\t\t\t\t\r\n\t\t\t\t}\r\n\r\n\t\t\t\tif (groupCol >= 0){\r\n\t\t\t\t\tthis.groupedRows = d3.nest()\r\n\t\t\t\t\t\t.key(function(d){return d[groupCol]})\r\n\t\t\t\t\t\t.entries(this.rows);\r\n\t\t\t\t\t\t\r\n\t\t\t\t\tthis.groupedRows.sort(\r\n\t\t\t\t\t\tfunction(a,b){\r\n\t\t\t\t\t\t\tvar aPos = GroupSortString.search(a.key);\r\n\t\t\t\t\t\t\tvar bPos = GroupSortString.search(b.key);\r\n\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\tif (aPos == bPos)\r\n\t\t\t\t\t\t\t\treturn a.key.localeCompare(b.key);\r\n\t\t\t\t\t\t\telse\r\n\t\t\t\t\t\t\t\treturn aPos - bPos;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t);\r\n\t\t\t\t\t\r\n\t\t\t\t\tvar gap = 5;\t\r\n\t\t\t\t\tvar dw = ((w + gap) / this.groupedRows.length);\r\n\t\t\t\t\tvar numRows = d3.max(this.groupedRows, function(d) { return d.values.length;} );\r\n\t\t\t\t\t\r\n\t\t\t\t\tfor(var i = 0; i < this.groupedRows.length; i++)\r\n\t\t\t\t\t\tplotGroupHorizontal(this.panel, this.svg, this.groupedRows[i].values, numRows, this.groupedRows[i].key, i * dw, /*(i * dw) +*/ dw - gap);\r\n\t\t\t\t}\r\n\t\t\t\telse {\r\n\t\t\t\t\tthis.groupedRows = null;\r\n\r\n\t\t\t\t\tplotGroupHorizontal(this.panel, this.svg, this.rows, this.rows.length, '', 0, w);\r\n\t\t\t\t}\r\n\t\t\t\t\r\n\t\t\t}\r\n\t\t\telse {\r\n\t\t\t\tvar valueScale = d3.scaleLinear()\r\n\t\t\t\t\t\t\t.domain([maxLineValue, minLineValue])\r\n\t\t\t\t\t\t\t.range([10, h - labelMargin])\r\n\t\t\t\t\t\t\t.nice();\r\n\t\t\t\t\r\n\t\t\t\tvar labelScale = d3.scaleBand()\r\n\t\t\t\t\t\t\t.domain(this.rows.map(function(d){ return d[labelCol]; }))\r\n\t\t\t\t\t\t\t.range([lowSideMargin, w - highSideMargin])\r\n\t\t\t\t\t\t\t.padding(barPadding / 100);\r\n\r\n\t\t\t\t// Draw background of alternating stripes \r\n\t\t\t\tvar oddeven = false;\r\n\t\t\t\tthis.svg//.append(\"g\")\r\n\t\t\t\t\t.selectAll(\"rect\")\r\n\t\t\t\t\t.data(this.rows)\r\n\t\t\t\t\t.enter()\r\n\t\t\t\t\t.append(\"rect\")\r\n\t\t\t\t\t.attr(\"class\", \"michaeldmoore-multistat-panel-row\")\r\n\t\t\t\t\t.attr(\"width\", labelScale.bandwidth())\r\n\t\t\t\t\t.attr(\"height\", h)\r\n\t\t\t\t\t.attr(\"x\", function(d,i){return labelScale(d[labelCol])})\r\n\t\t\t\t\t.attr(\"y\", 0)\r\n\t\t\t\t\t.attr(\"fill\", function(d) { \r\n\t\t\t\t\t\t\toddeven = !oddeven;\r\n\t\t\t\t\t\t\treturn oddeven ? OddRowColor : EvenRowColor;\r\n\t\t\t\t\t\t});\r\n\t\t\r\n\t\t\t\tfunction hLine(svg, value, color) {\t\r\n\t\t\t\t\tsvg.append(\"line\")\r\n\t\t\t\t\t\t.style(\"stroke\", color)\r\n\t\t\t\t\t\t.attr(\"x1\", lowSideMargin)\r\n\t\t\t\t\t\t.attr(\"y1\", valueScale(value))\r\n\t\t\t\t\t\t.attr(\"x2\", w - highSideMargin)\r\n\t\t\t\t\t\t.attr(\"y2\", valueScale(value));\r\n\t\t\t\t}\t\t\t\r\n\r\n\t\t\t\tif(this.panel.ShowBaseLine)\r\n\t\t\t\t\thLine(this.svg, baseLineValue, this.panel.BaseLineColor);\r\n\r\n\t\t\t\tif(this.panel.ShowMaxLine)\r\n\t\t\t\t\thLine(this.svg, maxLineValue, this.panel.MaxLineColor);\r\n\r\n\t\t\t\tif(this.panel.ShowMinLine)\r\n\t\t\t\t\thLine(this.svg, minLineValue, this.panel.MinLineColor);\r\n\r\n\t\t\t\tif(this.panel.ShowHighLimitLine)\r\n\t\t\t\t\thLine(this.svg, highLimitValue, this.panel.HighLimitLineColor);\r\n\r\n\t\t\t\tif(this.panel.ShowLowLimitLine)\r\n\t\t\t\t\thLine(this.svg, lowLimitValue, this.panel.LowLimitLineColor);\r\n\r\n\t\t\t\t\r\n\t\t\t\tthis.svg\r\n\t\t\t\t\t.append(\"g\")\r\n\t\t\t\t\t.selectAll(\"rect\")\r\n\t\t\t\t\t.data(this.rows)\r\n\t\t\t\t\t.enter()\r\n\t\t\t\t\t.append(\"rect\")\t\r\n\t\t\t\t\t.attr(\"class\", \"michaeldmoore-multistat-panel-bar\")\r\n\t\t\t\t\t.attr(\"height\", function(d) { \r\n\t\t\t\t\t\tvar hh = valueScale(d[valueCol]) - valueScale(baseLineValue);\r\n\t\t\t\t\t\tif (hh < 0)\r\n\t\t\t\t\t\t\thh = -hh;\r\n\t\t\t\t\t\treturn hh; \r\n\t\t\t\t\t\t})\r\n\t\t\t\t\t.attr(\"width\", labelScale.bandwidth())\r\n\t\t\t\t\t.attr(\"y\", function(d) { \r\n\t\t\t\t\t\treturn d3.min([valueScale(d[valueCol]), valueScale(baseLineValue)]); \r\n\t\t\t\t\t\t})\r\n\t\t\t\t\t.attr(\"x\", function(d, i) { return labelScale(d[labelCol]) })\r\n\t\t\t\t\t.attr(\"fill\", function(d) { \r\n\t\t\t\t\t\tif (recolorHighLimitBar && (d[valueCol] > highLimitValue))\r\n\t\t\t\t\t\t\treturn HighLimitBarColor;\r\n\t\t\t\t\t\tif (recolorLowLimitBar && (d[valueCol] < lowLimitValue))\r\n\t\t\t\t\t\t\treturn LowLimitBarColor;\r\n\t\t\t\t\t\treturn (d[valueCol] > baseLineValue) ? highBarColor : lowBarColor;\r\n\t\t\t\t\t\t})\r\n\t\t\t\t\t.classed(\"highflash\", function(d) { \r\n\t\t\t\t\t\treturn recolorHighLimitBar && flashHighLimitBar && (d[valueCol] > highLimitValue);\r\n\t\t\t\t\t\t})\r\n\t\t\t\t\t.classed(\"lowflash\", function(d) { \r\n\t\t\t\t\t\treturn recolorLowLimitBar && flashLowLimitBar && (d[valueCol] < lowLimitValue);\r\n\t\t\t\t\t\t})\r\n\t\t\t\t    .on(\"mouseover\", function(d) {\r\n\t\t\t\t\t\tif (showTooltips)\r\n\t\t\t\t\t\t\ttooltipShow(d, cols);\r\n\t\t\t\t\t\t})\r\n\t\t\t\t\t.on(\"mouseout\", function() { \r\n\t\t\t\t\t\ttooltipHide();\r\n\t\t\t\t\t\t});\r\n\r\n\t\t\t\t\r\n\t\t\t\tvar g = this.svg\r\n\t\t\t\t\t.selectAll(\"text\")\r\n\t\t\t\t\t.data(this.rows)\r\n\t\t\t\t\t.enter()\r\n\t\t\t\t\t.append(\"g\");\r\n\t\t\t\t\t\r\n\t\t\t\tif (this.panel.ShowValues) {\r\n\t\t\t\t\tg.append(\"text\")\r\n\t\t\t\t\t.text(function(d) {return d[valueCol].toFixed(ValueDecimals)})\r\n\t\t\t\t\t.attr(\"x\", function(d, i) { return labelScale(d[labelCol]) + (labelScale.bandwidth() / 2); })\r\n\t\t\t\t\t.attr(\"y\", function(d){\r\n\t\t\t\t\t\treturn valueScale(d[valueCol]) + ((d[valueCol] > baseLineValue) ? 5 : -5);\r\n\t\t\t\t\t})\t\t\t\t\t\t\r\n\t\t\t\t\t.attr(\"font-family\", \"sans-serif\")\r\n\t\t\t\t\t.attr(\"font-size\", this.panel.ValueFontSize)\r\n\t\t\t\t\t.attr(\"fill\", this.panel.ValueColor)\r\n\t\t\t\t\t.attr(\"text-anchor\", \"middle\")\r\n\t\t\t\t\t.attr(\"dominant-baseline\", function(d){return (d[valueCol] > baseLineValue) ? \"text-before-edge\" : \"text-after-edge\"});\r\n\t\t\t\t}\r\n\r\n\t\t\t\tif (this.panel.ShowLabels) {\r\n\t\t\t\t\tg.append(\"text\")\r\n\t\t\t\t\t.text(function(d) { return d[labelCol]; })\r\n\t\t\t\t\t.attr(\"x\", function(d, i) { return labelScale(d[labelCol]) + (labelScale.bandwidth() / 2); })\r\n\t\t\t\t\t.attr(\"y\", function(d) { return h - labelMargin + 14; })\r\n\t\t\t\t\t.attr(\"font-family\", \"sans-serif\")\r\n\t\t\t\t\t.attr(\"font-size\", this.panel.LabelFontSize)\r\n\t\t\t\t\t.attr(\"fill\", this.panel.LabelColor)\r\n\t\t\t\t\t.attr(\"text-anchor\", \"middle\");\r\n\t\t\t\t}\r\n\r\n\t\t\t\tif (lowSideMargin > 0) {\t\r\n\t\t\t\t\tvar gg = this.svg\r\n\t\t\t\t\t\t.append(\"g\")\r\n\t\t\t\t\t\t.attr('transform', 'translate(' + lowSideMargin + ', 0)')\r\n\t\t\t\t\t\t.classed('michaeldmoore-multistat-panel-valueaxis', true)\r\n\t\t\t\t\t\t.call(d3.axisLeft(valueScale).tickSizeInner(5).tickSizeOuter(10).ticks(5));\r\n\t\t\t\t\tgg.selectAll('.tick text').attr('fill', this.panel.LowAxisColor);\r\n\t\t\t\t\tgg.selectAll('.tick line').attr('stroke', this.panel.LowAxisColor);\r\n\t\t\t\t\tgg.selectAll('path.domain').attr('stroke', this.panel.LowAxisColor);\r\n\t\t\t\t}\r\n\t\t\t\t\r\n\t\t\t\tif (highSideMargin > 0) {\t\r\n\t\t\t\t\tvar gg = this.svg\r\n\t\t\t\t\t\t.append(\"g\")\r\n\t\t\t\t\t\t.attr('transform', 'translate(' + (w - highSideMargin) + ', 0)')\r\n\t\t\t\t\t\t.classed('michaeldmoore-multistat-panel-valueaxis', true)\r\n\t\t\t\t\t\t.call(d3.axisRight(valueScale).tickSizeInner(5).tickSizeOuter(10).ticks(5));\r\n\t\t\t\t\tgg.selectAll('.tick text').attr('fill', this.panel.HighAxisColor);\r\n\t\t\t\t\tgg.selectAll('.tick line').attr('stroke', this.panel.HighAxisColor);\r\n\t\t\t\t\tgg.selectAll('path.domain').attr('stroke', this.panel.HighAxisColor);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\t\t\t\t\r\n\t\t\tfunction pulseHigh(svg) {\r\n\t\t\t\tvar highFlashRects = svg.selectAll(\"rect.michaeldmoore-multistat-panel-bar.highflash\");\r\n\t\t\t\t\r\n\t\t\t\tif ($.isNumeric(HighLimitBarFlashTimeout) && highFlashRects._groups.length > 0 && highFlashRects._groups[0].length > 0) {\r\n\t\t\t\t\thighFlashRects\r\n\t\t\t\t\t.transition()\r\n\t\t\t\t\t.on(\"start\", function highRepeat() {\r\n\t\t\t\t\t\td3.active(this)\r\n\t\t\t\t\t\t\t.style(\"fill\", HighLimitBarFlashColor)\r\n\t\t\t\t\t\t\t.duration(HighLimitBarFlashTimeout)\r\n\t\t\t\t\t\t\t.transition()\r\n\t\t\t\t\t\t\t.style(\"fill\", HighLimitBarColor)\r\n\t\t\t\t\t\t\t.duration(HighLimitBarFlashTimeout)\r\n\t\t\t\t\t\t\t.transition()\r\n\t\t\t\t\t\t\t.on(\"start\", highRepeat);\r\n\t\t\t\t\t  });\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\tfunction pulseLow(svg) {\r\n\t\t\t\tvar lowFlashRects = svg.selectAll(\"rect.michaeldmoore-multistat-panel-bar.lowflash\");\r\n\t\t\t\tif ($.isNumeric(LowLimitBarFlashTimeout) && lowFlashRects._groups.length > 0 && lowFlashRects._groups[0].length > 0) {\r\n\t\t\t\t\tlowFlashRects\r\n\t\t\t\t\t.transition()\r\n\t\t\t\t\t.on(\"start\", function lowRepeat() {\r\n\t\t\t\t\t\td3.active(this)\r\n\t\t\t\t\t\t\t.style(\"fill\", LowLimitBarFlashColor)\r\n\t\t\t\t\t\t\t.duration(LowLimitBarFlashTimeout)\r\n\t\t\t\t\t\t\t.transition()\r\n\t\t\t\t\t\t\t.style(\"fill\", LowLimitBarColor)\r\n\t\t\t\t\t\t\t.duration(LowLimitBarFlashTimeout)\r\n\t\t\t\t\t\t\t.transition()\r\n\t\t\t\t\t\t\t.on(\"start\", lowRepeat);\r\n\t\t\t\t\t  });\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\t\r\n\r\n\t\t\tpulseHigh(this.svg);\r\n\t\t\tpulseLow(this.svg);\r\n\t\t}\r\n\t\telse\r\n\t\t\tthis.elem.html(\"<div style='position:absolute;top:50%;text-align:center;font-size:0.875rem;'>No data to show!!</div>\");\r\n\r\n\t\t\t\t\t\t\r\n        this.ctrl.renderingCompleted();\r\n    }\r\n\r\n    onConfigChanged() {\r\n        this.refresh();\r\n    }\r\n\r\n    link(scope, elem, attrs, ctrl) {\r\n        this.ctrl = ctrl;\r\n        this.elem = elem.find('.panel-content');\r\n    }\r\n}\r\n\r\nMultistatPanelCtrl.templateUrl = 'module.html';\r\n\r\nexport {\r\n    MultistatPanelCtrl as PanelCtrl\r\n};\r\n"]}